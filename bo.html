<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜ì–´í‹€ ì œì‘ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #333;
            --light-color: rgba(51, 51, 51, 0.1);
            --speech-color: rgba(51, 51, 51, 0.2);
            --emoji-border-color: #ccc;
        }

        * { box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 15px;
            min-width: 1240px;
            overflow-x: auto;
        }

        .fairtle-card {
            background: white;
            border: 1px solid #e1e8ed;
            width: 1200px;
            margin: 0 auto;
            padding: 30px;
            display: grid;
            grid-template-columns: 280px 2fr 280px;
            grid-template-rows: auto auto 1fr;
            gap: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 15px;
            position: relative;
        }

        /* Header */
        .pair-header {
            grid-column: 1 / -1;
            text-align: center;
            border-bottom: 2px solid var(--primary-color, #333);
            padding-bottom: 15px;
        }

        .pair-title {
            font-size: 2.2em;
            font-weight: 700;
            color: #333;
            letter-spacing: 2px;
        }

        .pair-subtitle {
            font-size: 1em;
            color: #666;
            margin-top: 6px;
        }

        /* Character Profile */
        .character-profile {
            text-align: center;
            border: 1px solid #eee;
            background: white;
        }

        .character-avatar {
            width: 100%;
            height: 220px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ccc;
            font-size: 0.8em;
            margin-bottom: 15px;
            position: relative;
            background-size: cover;
            background-position: center;
        }

        .character-avatar.has-image::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to bottom, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0) 50%, 
                rgba(255,255,255,0.3) 70%, 
                rgba(255,255,255,1) 100%
            );
            pointer-events: none;
            z-index: 1;
        }

        .color-chart {
            position: absolute;
            top: 10px;
            left: 10px;
            display: grid;
            gap: 3px;
            z-index: 10;
        }

        .color-square {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.15);
        }

        .emoji-circle {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--emoji-border-color, #ccc);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            z-index: 10;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-family: 'Noto Color Emoji', 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;
        }

        .profile-content {
            padding: 0 15px 15px 15px;
        }

        .profile-info {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .character-name {
            font-size: 1.6em;
            font-weight: 600;
            color: #333;
            text-align: right;
            flex: 1;
        }

        .character-basic {
            font-size: 0.65em;
            color: #666;
            line-height: 1.3;
            text-align: left;
            flex: 1;
            margin-left: 8px;
        }

        .character-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
            margin-top: 8px;
        }

        .keyword-tag {
            background: var(--light-color, #f0f0f0);
            color: #555;
            padding: 3px 8px;
            font-size: 0.65em;
            border: 1px solid #ddd;
        }

        .character-speech {
            margin-top: 15px;
            padding: 12px 15px;
            background: var(--speech-color, #e0e0e0);
            border-radius: 15px;
            position: relative;
            font-size: 0.8em;
            color: #333;
            line-height: 1.3;
        }

        .character-speech::after {
            content: '';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }

        .character-speech.left::after {
            left: -7px;
            border-right: 7px solid var(--speech-color, #e0e0e0);
        }

        .character-speech.right::after {
            right: -7px;
            border-left: 7px solid var(--speech-color, #e0e0e0);
        }

        /* Character Details */
        .character-details {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .detail-section {
            border: 1px solid #eee;
            background: white;
        }

        .detail-title {
            font-size: 0.9em;
            font-weight: 600;
            color: #333;
            padding: 10px 12px;
            background: var(--light-color, #f8f8f8);
            border-bottom: 1px solid #eee;
        }

        .detail-content {
            font-size: 0.8em;
            color: #555;
            line-height: 1.6;
            padding: 12px;
            min-height: 100px;
            white-space: pre-wrap;
        }

        /* Timeline */
        .timeline-section {
            border: 1px solid #ddd;
            background: white;
            padding: 20px;
        }

        .timeline-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .timeline-container {
            position: relative;
            padding: 20px 0;
        }

        .timeline-line {
            position: absolute;
            left: 30px;
            top: 0;
            width: 2px;
            background: var(--primary-color, #333);
            height: 85%;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 40px;
            padding-left: 60px;
        }

        .timeline-dot {
            position: absolute;
            left: 25px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-color, #333);
            border: 3px solid white;
        }

        .timeline-dot::after {
            content: '';
            position: absolute;
            top: -5px; left: -5px; right: -5px; bottom: -5px;
            border-radius: 50%;
            border: 2px solid var(--primary-color, #333);
        }

        .timeline-date {
            font-size: 0.9em;
            font-weight: 600;
            color: white;
            margin-bottom: 4px;
            padding: 3px 8px;
            background: var(--primary-color, #333);
            display: inline-block;
            border-radius: 3px;
        }

        .timeline-title-text {
            font-size: 0.95em;
            font-weight: 500;
            color: #555;
            margin-bottom: 6px;
        }

        .timeline-desc {
            font-size: 0.8em;
            color: #666;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .timeline-image {
            width: 100%;
            height: auto;
            border-radius: 5px;
            margin-top: 8px;
            border: 1px solid #ddd;
            display: block;
        }

        /* Stickers */
        .fairtle-sticker {
            position: absolute;
            cursor: move;
            z-index: 100;
            border: 2px solid transparent;
            user-select: none;
            pointer-events: auto;
        }

        .fairtle-sticker img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            pointer-events: none;
        }

        .fairtle-sticker:hover,
        .fairtle-sticker.selected {
            border-color: #007bff;
        }

        .sticker-controls {
            position: absolute;
            top: -8px;
            right: -8px;
            display: none;
            flex-direction: column;
            gap: 4px;
        }

        .fairtle-sticker.selected .sticker-controls {
            display: flex;
        }

        .sticker-delete {
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 101;
        }

        .sticker-rotate {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 101;
        }

        .sticker-rotate:active {
            cursor: grabbing;
        }

        .resize-handle {
            position: absolute;
            bottom: -8px;
            right: -8px;
            width: 16px;
            height: 16px;
            background: #007bff;
            border: 2px solid white;
            border-radius: 50%;
            cursor: se-resize;
            display: none;
            z-index: 101;
        }

        .fairtle-sticker.selected .resize-handle {
            display: block;
        }

        /* UI Controls */
        .edit-button, .download-button {
            position: fixed;
            bottom: 30px;
            background: #333;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .edit-button {
            right: 30px;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 20px;
        }

        .download-button {
            left: 30px;
            padding: 12px 20px;
        }

        /* Edit Panel */
        .edit-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60vh;
            background: white;
            border-top: 2px solid #333;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 999;
            overflow-y: auto;
        }

        .edit-panel.active {
            transform: translateY(0);
        }

        .edit-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .edit-panel-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
        }

        .edit-content {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            font-size: 14px;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            line-height: 1.6;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .sticker-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            min-height: 60px;
            border: 1px dashed #ddd;
            padding: 10px;
            background: #fafafa;
        }

        .sticker-preview {
            position: relative;
            width: 50px;
            height: 50px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            cursor: pointer;
            background: white;
        }

        .sticker-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .sticker-preview:hover {
            border-color: #007bff;
        }

        .timeline-form-item {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 15px;
            background: #fafafa;
        }

        .color-input-group {
            display: flex;
            gap: 8px;
        }

        .color-input-item {
            flex: 1;
            min-width: 50px;
        }

        .color-input-item input {
            width: 100%;
            height: 40px;
            padding: 0;
            border-radius: 4px;
        }

        .color-input-label {
            font-size: 11px;
            color: #666;
            text-align: center;
            margin-top: 2px;
        }

        .basic-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .basic-info-grid input {
            padding: 8px;
        }

        .btn-add {
            width: 100%;
            padding: 10px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            margin-top: 10px;
            cursor: pointer;
        }

        .btn-delete {
            background: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 12px;
            margin-top: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="fairtle-card" id="fairtle-card">
        <div class="pair-header">
            <div class="pair-title" id="pair-title">SAMPLE PAIR</div>
            <div class="pair-subtitle" id="pair-subtitle">ìºë¦­í„° A Ã— ìºë¦­í„° B</div>
        </div>
        
        <!-- ìºë¦­í„° A -->
        <div class="character-section">
            <div class="character-profile">
                <div class="character-avatar" id="char1-avatar">
                    <div class="color-chart">
                        <div class="color-square" id="char1-hair-color" style="background: #8B4513;"></div>
                        <div class="color-square" id="char1-eyes-color" style="background: #4169E1;"></div>
                        <div class="color-square" id="char1-skin-color" style="background: #FDBCB4;"></div>
                    </div>
                    <div class="emoji-circle" id="char1-emoji">ğŸ±</div>
                    í”„ë¡œí•„ ì´ë¯¸ì§€
                </div>
                <div class="profile-content">
                    <div class="profile-info">
                        <div class="character-name" id="char1-name">ìºë¦­í„° A</div>
                        <div class="character-basic" id="char1-basic">
                            <div>ë‚¨ì„± | 20ì„¸ | 175cm</div>
                            <div>í•™ìƒ</div>
                        </div>
                    </div>
                    <div class="character-keywords" id="char1-keywords">
                        <span class="keyword-tag">ì„±ê²©1</span>
                        <span class="keyword-tag">ì„±ê²©2</span>
                        <span class="keyword-tag">ì„±ê²©3</span>
                    </div>
                    <div class="character-speech left" id="char1-speech">ìºë¦­í„° Aê°€ ìºë¦­í„° Bì—ê²Œ í•˜ëŠ” ë§</div>
                </div>
            </div>
            
            <div class="character-details">
                <div class="detail-section">
                    <div class="detail-title">Backstory</div>
                    <div class="detail-content" id="char1-past">ìºë¦­í„°ì˜ ê³¼ê±° ì´ì•¼ê¸°ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-title">Etc.</div>
                    <div class="detail-content" id="char1-features">ìºë¦­í„°ì˜ ë…íŠ¹í•œ íŠ¹ì§•ì´ë‚˜ ìŠµê´€, ë²„ë¦‡ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</div>
                </div>
                
                <div class="character-extra-sections" id="char1-extra-sections"></div>
            </div>
        </div>

        <!-- Timeline -->
        <div class="timeline-section">
            <div class="timeline-title">Timeline</div>
            <div class="timeline-container" id="timeline-container">
                <div class="timeline-line"></div>
            </div>
        </div>

        <!-- ìºë¦­í„° B -->
        <div class="character-section">
            <div class="character-profile">
                <div class="character-avatar" id="char2-avatar">
                    <div class="emoji-circle" id="char2-emoji" style="left: 10px; right: auto;">ğŸ°</div>
                    <div class="color-chart" style="left: auto; right: 10px;">
                        <div class="color-square" id="char2-hair-color" style="background: #8B4513;"></div>
                        <div class="color-square" id="char2-eyes-color" style="background: #4169E1;"></div>
                        <div class="color-square" id="char2-skin-color" style="background: #FDBCB4;"></div>
                    </div>
                    í”„ë¡œí•„ ì´ë¯¸ì§€
                </div>
                <div class="profile-content">
                    <div class="profile-info">
                        <div class="character-name" id="char2-name">ìºë¦­í„° B</div>
                        <div class="character-basic" id="char2-basic">
                            <div>ì—¬ì„± | 22ì„¸ | 180cm</div>
                            <div>ì§ì¥ì¸</div>
                        </div>
                    </div>
                    <div class="character-keywords" id="char2-keywords">
                        <span class="keyword-tag">ì„±ê²©1</span>
                        <span class="keyword-tag">ì„±ê²©2</span>
                        <span class="keyword-tag">ì„±ê²©3</span>
                    </div>
                    <div class="character-speech right" id="char2-speech">ìºë¦­í„° Bê°€ ìºë¦­í„° Aì—ê²Œ í•˜ëŠ” ë§</div>
                </div>
            </div>
            
            <div class="character-details">
                <div class="detail-section">
                    <div class="detail-title">Backstory</div>
                    <div class="detail-content" id="char2-past">ìºë¦­í„° Bì˜ ê³¼ê±° ì´ì•¼ê¸°ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-title">Etc.</div>
                    <div class="detail-content" id="char2-features">ìºë¦­í„° Bì˜ ë…íŠ¹í•œ íŠ¹ì§•ì´ë‚˜ ìŠµê´€, ë²„ë¦‡ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</div>
                </div>
                
                <div class="character-extra-sections" id="char2-extra-sections"></div>
            </div>
        </div>
    </div>

    <button class="edit-button" onclick="app.toggleEdit()">âœï¸</button>
    <button class="download-button" onclick="app.downloadImage()">ğŸ“¥ ì €ì¥</button>

    <div class="edit-panel" id="edit-panel">
        <div class="edit-panel-header">
            <div class="edit-panel-title">í˜ì–´í‹€ í¸ì§‘</div>
            <button class="close-button" onclick="app.closeEdit()">Ã—</button>
        </div>
        <div class="edit-content">
            <!-- í˜ì–´ëª… -->
            <div class="form-group">
                <label class="form-label">í˜ì–´ëª…</label>
                <input type="text" class="form-input" id="input-pair-title" value="SAMPLE PAIR">
            </div>

            <!-- í˜ì–´ ë¶€ì œëª© -->
            <div class="form-group">
                <label class="form-label">í˜ì–´ ë¶€ì œëª©</label>
                <input type="text" class="form-input" id="input-pair-subtitle" value="ìºë¦­í„° A Ã— ìºë¦­í„° B">
            </div>

            <!-- í˜ì–´ ëŒ€í‘œì»¬ëŸ¬ -->
            <div class="form-group">
                <label class="form-label">í˜ì–´ ëŒ€í‘œì»¬ëŸ¬</label>
                <input type="color" class="form-input" id="input-pair-color" value="#333333" style="height: 50px; padding: 5px; cursor: pointer;">
            </div>

            <!-- ìŠ¤í‹°ì»¤ ì¶”ê°€ -->
            <div class="form-group">
                <label class="form-label">ìŠ¤í‹°ì»¤ ì¶”ê°€</label>
                <input type="file" class="form-input" id="input-sticker-upload" accept="image/*" multiple>
                <div id="sticker-preview-container" class="sticker-preview-container">
                    <div style="width: 100%; text-align: center; color: #999; font-size: 12px;">ìŠ¤í‹°ì»¤ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë˜ê³ , í´ë¦­í•´ì„œ í˜ì–´í‹€ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
                </div>
            </div>

            <!-- A/B í”„ë¡œí•„ ì´ë¯¸ì§€ -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A í”„ë¡œí•„ ì´ë¯¸ì§€</label>
                    <input type="file" class="form-input" id="input-char1-image" accept="image/*">
                </div>
                <div class="form-group">
                    <label class="form-label">B í”„ë¡œí•„ ì´ë¯¸ì§€</label>
                    <input type="file" class="form-input" id="input-char2-image" accept="image/*">
                </div>
            </div>

            <!-- A/B ì´ë¦„ -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A ì´ë¦„</label>
                    <input type="text" class="form-input" id="input-char1-name" value="ìºë¦­í„° A">
                </div>
                <div class="form-group">
                    <label class="form-label">B ì´ë¦„</label>
                    <input type="text" class="form-input" id="input-char2-name" value="ìºë¦­í„° B">
                </div>
            </div>

            <!-- A/B ê¸°ë³¸ì •ë³´ -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A ê¸°ë³¸ì •ë³´</label>
                    <div class="basic-info-grid">
                        <input type="text" class="form-input" id="input-char1-gender" placeholder="ì„±ë³„" value="ë‚¨ì„±">
                        <input type="text" class="form-input" id="input-char1-age" placeholder="ë‚˜ì´" value="20">
                        <input type="text" class="form-input" id="input-char1-height" placeholder="í‚¤" value="175cm">
                        <input type="text" class="form-input" id="input-char1-job" placeholder="ì§ì—…" value="í•™ìƒ">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">B ê¸°ë³¸ì •ë³´</label>
                    <div class="basic-info-grid">
                        <input type="text" class="form-input" id="input-char2-gender" placeholder="ì„±ë³„" value="ì—¬ì„±">
                        <input type="text" class="form-input" id="input-char2-age" placeholder="ë‚˜ì´" value="22">
                        <input type="text" class="form-input" id="input-char2-height" placeholder="í‚¤" value="180cm">
                        <input type="text" class="form-input" id="input-char2-job" placeholder="ì§ì—…" value="ì§ì¥ì¸">
                    </div>
                </div>
            </div>

            <!-- A/B ì„±ê²© í‚¤ì›Œë“œ -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A ì„±ê²© í‚¤ì›Œë“œ</label>
                    <input type="text" class="form-input" id="input-char1-keywords" placeholder="ì„±ê²©1, ì„±ê²©2, ì„±ê²©3" value="ì„±ê²©1, ì„±ê²©2, ì„±ê²©3">
                </div>
                <div class="form-group">
                    <label class="form-label">B ì„±ê²© í‚¤ì›Œë“œ</label>
                    <input type="text" class="form-input" id="input-char2-keywords" placeholder="ì„±ê²©1, ì„±ê²©2, ì„±ê²©3" value="ì„±ê²©1, ì„±ê²©2, ì„±ê²©3">
                </div>
            </div>

            <!-- A/B ì»¬ëŸ¬ì°¨íŠ¸ -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A ì»¬ëŸ¬ì°¨íŠ¸</label>
                    <div class="color-input-group">
                        <div class="color-input-item">
                            <input type="color" class="form-input" id="input-char1-hair" value="#8B4513">
                            <div class="color-input-label">ë¨¸ë¦¬</div>
                        </div>
                        <div class="color-input-item">
                            <input type="color" class="form-input" id="input-char1-eyes" value="#4169E1">
                            <div class="color-input-label">ëˆˆ</div>
                        </div>
                        <div class="color-input-item">
                            <input type="color" class="form-input" id="input-char1-skin" value="#FDBCB4">
                            <div class="color-input-label">í”¼ë¶€</div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">B ì»¬ëŸ¬ì°¨íŠ¸</label>
                    <div class="color-input-group">
                        <div class="color-input-item">
                            <input type="color" class="form-input" id="input-char2-hair" value="#8B4513">
                            <div class="color-input-label">ë¨¸ë¦¬</div>
                        </div>
                        <div class="color-input-item">
                            <input type="color" class="form-input" id="input-char2-eyes" value="#4169E1">
                            <div class="color-input-label">ëˆˆ</div>
                        </div>
                        <div class="color-input-item">
                            <input type="color" class="form-input" id="input-char2-skin" value="#FDBCB4">
                            <div class="color-input-label">í”¼ë¶€</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- A/B ì´ëª¨ì§€ -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A ì´ëª¨ì§€</label>
                    <input type="text" class="form-input" id="input-char1-emoji" value="ğŸ±" maxlength="2" style="text-align: center; font-size: 18px;">
                </div>
                <div class="form-group">
                    <label class="form-label">B ì´ëª¨ì§€</label>
                    <input type="text" class="form-input" id="input-char2-emoji" value="ğŸ°" maxlength="2" style="text-align: center; font-size: 18px;">
                </div>
            </div>

            <!-- Aâ†’B/Bâ†’A í•œë§ˆë”” -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A â†’ B í•œë§ˆë””</label>
                    <textarea class="form-input form-textarea" id="input-char1-speech">ìºë¦­í„° Aê°€ ìºë¦­í„° Bì—ê²Œ í•˜ëŠ” ë§</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">B â†’ A í•œë§ˆë””</label>
                    <textarea class="form-input form-textarea" id="input-char2-speech">ìºë¦­í„° Bê°€ ìºë¦­í„° Aì—ê²Œ í•˜ëŠ” ë§</textarea>
                </div>
            </div>

            <!-- A/B Backstory -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A Backstory</label>
                    <textarea class="form-input form-textarea" id="input-char1-past" placeholder="ìºë¦­í„°ì˜ ê³¼ê±° ì´ì•¼ê¸°">ìºë¦­í„°ì˜ ê³¼ê±° ì´ì•¼ê¸°ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">B Backstory</label>
                    <textarea class="form-input form-textarea" id="input-char2-past" placeholder="ìºë¦­í„°ì˜ ê³¼ê±° ì´ì•¼ê¸°">ìºë¦­í„° Bì˜ ê³¼ê±° ì´ì•¼ê¸°ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</textarea>
                </div>
            </div>

            <!-- A/B Etc. -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A Etc.</label>
                    <textarea class="form-input form-textarea" id="input-char1-features" placeholder="ìºë¦­í„°ì˜ íŠ¹ì§•ì´ë‚˜ ìŠµê´€">ìºë¦­í„°ì˜ ë…íŠ¹í•œ íŠ¹ì§•ì´ë‚˜ ìŠµê´€, ë²„ë¦‡ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</textarea>
                    <div id="char1-extra-form" style="margin-top: 15px;"></div>
                    <button type="button" onclick="app.addExtraSection('char1')" style="width: 100%; padding: 8px; background: #f0f0f0; border: 1px solid #ddd; margin-top: 10px; cursor: pointer; font-size: 12px;">+ ì„¹ì…˜ ì¶”ê°€</button>
                </div>
                <div class="form-group">
                    <label class="form-label">B Etc.</label>
                    <textarea class="form-input form-textarea" id="input-char2-features" placeholder="ìºë¦­í„°ì˜ íŠ¹ì§•ì´ë‚˜ ìŠµê´€">ìºë¦­í„° Bì˜ ë…íŠ¹í•œ íŠ¹ì§•ì´ë‚˜ ìŠµê´€, ë²„ë¦‡ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</textarea>
                    <div id="char2-extra-form" style="margin-top: 15px;"></div>
                    <button type="button" onclick="app.addExtraSection('char2')" style="width: 100%; padding: 8px; background: #f0f0f0; border: 1px solid #ddd; margin-top: 10px; cursor: pointer; font-size: 12px;">+ ì„¹ì…˜ ì¶”ê°€</button>
                </div>
            </div>

            <!-- Timeline í¸ì§‘ -->
            <div class="form-group">
                <label class="form-label">Timeline í¸ì§‘</label>
                <div id="timeline-form-container"></div>
                <button type="button" class="btn-add" onclick="app.addTimelineItem()">+ Timeline ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // ì•± ì „ì²´ ê´€ë¦¬ ê°ì²´
        const app = {
            // ë°ì´í„°
            timelineData: [
                { date: '1999-06', title: 'ì²« ë§Œë‚¨', desc: 'ìš°ì—°íˆ ê°™ì€ ì¹´í˜ì—ì„œ ë§ˆì£¼ì¹˜ê²Œ ë˜ë©´ì„œ ì‹œì‘ëœ ì¸ì—°', image: null },
                { date: '2000-03', title: 'ê°ˆë“±', desc: 'ì„œë¡œ ë‹¤ë¥¸ ê°€ì¹˜ê´€ìœ¼ë¡œ ì¸í•œ ì²« ë²ˆì§¸ í° ê°ˆë“±ì´ ë°œìƒ', image: null },
                { date: '2020-01', title: 'í™”í•´', desc: 'ì˜¤ëœ ì‹œê°„ì´ ì§€ë‚œ í›„ ìš°ì—°íˆ ì¬íšŒí•˜ê²Œ ë˜ë©´ì„œ ìƒˆë¡œìš´ ê´€ê³„ë¥¼ ì‹œì‘', image: null }
            ],
            stickerData: [],
            placedStickers: [],
            selectedSticker: null,
            isDragging: false,
            isResizing: false,
            isRotating: false,
            dragOffset: { x: 0, y: 0 },
            rotateStartAngle: 0,
            extraSections: { char1: [], char2: [] }, // ì¶”ê°€ ì„¹ì…˜ ë°ì´í„°

            // ì´ˆê¸°í™”
            init() {
                this.setupEventListeners();
                this.updateTimelineDisplay();
                this.updateTimelineForm();
                this.updateColors(); // ì´ˆê¸° ì»¬ëŸ¬ ì ìš©
            },

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners() {
                // ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸
                const inputs = [
                    'input-pair-title', 'input-pair-subtitle', 'input-char1-name', 'input-char2-name',
                    'input-char1-gender', 'input-char1-age', 'input-char1-height', 'input-char1-job',
                    'input-char2-gender', 'input-char2-age', 'input-char2-height', 'input-char2-job',
                    'input-char1-keywords', 'input-char2-keywords', 'input-char1-past', 'input-char2-past',
                    'input-char1-features', 'input-char2-features', 'input-char1-speech', 'input-char2-speech'
                ];

                inputs.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', () => this.updatePreview());
                    }
                });

                // ì»¬ëŸ¬ ì´ë²¤íŠ¸
                document.getElementById('input-pair-color').addEventListener('change', () => this.updateColors());
                
                const colorInputs = ['char1-hair', 'char1-eyes', 'char1-skin', 'char2-hair', 'char2-eyes', 'char2-skin'];
                colorInputs.forEach(id => {
                    const element = document.getElementById(`input-${id}`);
                    if (element) {
                        element.addEventListener('change', () => this.updateCharacterColors());
                    }
                });

                // ì´ëª¨ì§€ ì´ë²¤íŠ¸
                document.getElementById('input-char1-emoji').addEventListener('input', () => this.updateEmojis());
                document.getElementById('input-char2-emoji').addEventListener('input', () => this.updateEmojis());

                // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì´ë²¤íŠ¸
                document.getElementById('input-char1-image').addEventListener('change', (e) => this.handleImageUpload('char1', e));
                document.getElementById('input-char2-image').addEventListener('change', (e) => this.handleImageUpload('char2', e));

                // ìŠ¤í‹°ì»¤ ì—…ë¡œë“œ ì´ë²¤íŠ¸
                document.getElementById('input-sticker-upload').addEventListener('change', (e) => this.handleStickerUpload(e));

                // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
                document.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                document.addEventListener('mouseup', () => this.handleMouseUp());
                document.addEventListener('keydown', (e) => this.handleKeyDown(e));

                // í˜ì–´í‹€ ì¹´ë“œ í´ë¦­
                document.getElementById('fairtle-card').addEventListener('click', (e) => this.handleCardClick(e));
            },

            // UI ì»¨íŠ¸ë¡¤
            toggleEdit() {
                const panel = document.getElementById('edit-panel');
                if (panel.classList.contains('active')) {
                    panel.classList.remove('active');
                } else {
                    panel.classList.add('active');
                    this.updateInputs();
                }
            },

            closeEdit() {
                document.getElementById('edit-panel').classList.remove('active');
            },

            // ì…ë ¥ê°’ì„ í¼ì— ì—…ë°ì´íŠ¸
            updateInputs() {
                const pairs = [
                    ['pair-title', 'input-pair-title'],
                    ['pair-subtitle', 'input-pair-subtitle'],
                    ['char1-name', 'input-char1-name'],
                    ['char2-name', 'input-char2-name'],
                    ['char1-speech', 'input-char1-speech'],
                    ['char2-speech', 'input-char2-speech'],
                    ['char1-past', 'input-char1-past'],
                    ['char2-past', 'input-char2-past'],
                    ['char1-features', 'input-char1-features'],
                    ['char2-features', 'input-char2-features']
                ];

                pairs.forEach(([sourceId, targetId]) => {
                    const source = document.getElementById(sourceId);
                    const target = document.getElementById(targetId);
                    if (source && target) {
                        target.value = source.textContent;
                    }
                });

                // ê¸°ë³¸ì •ë³´ íŒŒì‹±
                this.parseBasicInfo('char1');
                this.parseBasicInfo('char2');

                // í‚¤ì›Œë“œ íŒŒì‹±
                this.parseKeywords('char1');
                this.parseKeywords('char2');
            },

            parseBasicInfo(charType) {
                const basicEl = document.getElementById(`${charType}-basic`);
                if (!basicEl) return;

                const basicText = basicEl.children[0].textContent;
                const job = basicEl.children[1].textContent;
                const parts = basicText.split(' | ');

                if (parts.length >= 3) {
                    document.getElementById(`input-${charType}-gender`).value = parts[0];
                    document.getElementById(`input-${charType}-age`).value = parts[1].replace('ì„¸', '');
                    document.getElementById(`input-${charType}-height`).value = parts[2];
                }
                document.getElementById(`input-${charType}-job`).value = job;
            },

            parseKeywords(charType) {
                const keywordsEl = document.getElementById(`${charType}-keywords`);
                if (!keywordsEl) return;

                const keywords = Array.from(keywordsEl.querySelectorAll('.keyword-tag'))
                    .map(tag => tag.textContent).join(', ');
                document.getElementById(`input-${charType}-keywords`).value = keywords;
            },

            // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            updatePreview() {
                // ê¸°ë³¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                const updates = [
                    ['input-pair-title', 'pair-title'],
                    ['input-pair-subtitle', 'pair-subtitle'],
                    ['input-char1-name', 'char1-name'],
                    ['input-char2-name', 'char2-name'],
                    ['input-char1-speech', 'char1-speech'],
                    ['input-char2-speech', 'char2-speech'],
                    ['input-char1-past', 'char1-past'],
                    ['input-char2-past', 'char2-past'],
                    ['input-char1-features', 'char1-features'],
                    ['input-char2-features', 'char2-features']
                ];

                updates.forEach(([sourceId, targetId]) => {
                    const source = document.getElementById(sourceId);
                    const target = document.getElementById(targetId);
                    if (source && target) {
                        target.textContent = source.value;
                    }
                });

                // ê¸°ë³¸ì •ë³´ ì—…ë°ì´íŠ¸
                this.updateBasicInfo('char1');
                this.updateBasicInfo('char2');

                // í‚¤ì›Œë“œ ì—…ë°ì´íŠ¸
                this.updateKeywords('char1');
                this.updateKeywords('char2');
            },

            updateBasicInfo(charType) {
                const gender = document.getElementById(`input-${charType}-gender`).value;
                const age = document.getElementById(`input-${charType}-age`).value;
                const height = document.getElementById(`input-${charType}-height`).value;
                const job = document.getElementById(`input-${charType}-job`).value;

                const basicEl = document.getElementById(`${charType}-basic`);
                if (basicEl) {
                    basicEl.innerHTML = `
                        <div>${gender} | ${age}ì„¸ | ${height.replace('cm', '')}cm</div>
                        <div>${job}</div>
                    `;
                }
            },

            updateKeywords(charType) {
                const keywordsText = document.getElementById(`input-${charType}-keywords`).value;
                const keywordsEl = document.getElementById(`${charType}-keywords`);
                if (!keywordsEl) return;

                const keywords = keywordsText.split(',').map(k => k.trim()).filter(k => k);
                keywordsEl.innerHTML = '';
                keywords.forEach(keyword => {
                    const tag = document.createElement('span');
                    tag.className = 'keyword-tag';
                    tag.textContent = keyword;
                    keywordsEl.appendChild(tag);
                });
            },

            // ì»¬ëŸ¬ ì—…ë°ì´íŠ¸
            updateColors() {
                const color = document.getElementById('input-pair-color').value;
                const root = document.documentElement;
                
                root.style.setProperty('--primary-color', color);
                root.style.setProperty('--light-color', this.hexToRgba(color, 0.1));
                root.style.setProperty('--speech-color', this.hexToRgba(color, 0.2));
                
                // ì´ëª¨ì§€ ë™ê·¸ë¼ë¯¸ í…Œë‘ë¦¬ ìƒ‰ìƒ (ëŒ€í‘œì»¬ëŸ¬ë¥¼ 60% íˆ¬ëª…ë„ë¡œ ì§„í•˜ê²Œ)
                root.style.setProperty('--emoji-border-color', this.hexToRgba(color, 0.6));
            },

            updateCharacterColors() {
                const colors = ['char1-hair', 'char1-eyes', 'char1-skin', 'char2-hair', 'char2-eyes', 'char2-skin'];
                colors.forEach(colorId => {
                    const input = document.getElementById(`input-${colorId}`);
                    const target = document.getElementById(`${colorId}-color`);
                    if (input && target) {
                        target.style.background = input.value;
                    }
                });
            },

            updateEmojis() {
                const char1Emoji = document.getElementById('input-char1-emoji').value;
                const char2Emoji = document.getElementById('input-char2-emoji').value;
                
                document.getElementById('char1-emoji').textContent = char1Emoji;
                document.getElementById('char2-emoji').textContent = char2Emoji;
            },

            hexToRgba(hex, alpha) {
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            },

            // ë‘ ìƒ‰ìƒì„ ì„ëŠ” í•¨ìˆ˜ (íšŒìƒ‰ ë² ì´ìŠ¤ì— ëŒ€í‘œì»¬ëŸ¬ ì„ê¸°ìš©)
            mixColors(baseColor, mixColor, ratio) {
                const base = {
                    r: parseInt(baseColor.slice(1, 3), 16),
                    g: parseInt(baseColor.slice(3, 5), 16),
                    b: parseInt(baseColor.slice(5, 7), 16)
                };
                const mix = {
                    r: parseInt(mixColor.slice(1, 3), 16),
                    g: parseInt(mixColor.slice(3, 5), 16),
                    b: parseInt(mixColor.slice(5, 7), 16)
                };
                
                const result = {
                    r: Math.round(base.r * (1 - ratio) + mix.r * ratio),
                    g: Math.round(base.g * (1 - ratio) + mix.g * ratio),
                    b: Math.round(base.b * (1 - ratio) + mix.b * ratio)
                };
                
                return `rgb(${result.r}, ${result.g}, ${result.b})`;
            },

            // ì´ë¯¸ì§€ ì—…ë¡œë“œ
            handleImageUpload(charType, event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    const avatarEl = document.getElementById(`${charType}-avatar`);
                    if (avatarEl) {
                        avatarEl.style.backgroundImage = `url(${e.target.result})`;
                        avatarEl.classList.add('has-image');
                        // í…ìŠ¤íŠ¸ ë…¸ë“œ ì œê±°
                        Array.from(avatarEl.childNodes)
                            .filter(node => node.nodeType === 3)
                            .forEach(node => node.remove());
                    }
                };
                reader.readAsDataURL(file);
            },

            // ìŠ¤í‹°ì»¤ ê´€ë ¨
            handleStickerUpload(event) {
                const files = event.target.files;
                const container = document.getElementById('sticker-preview-container');
                
                if (this.stickerData.length === 0) {
                    container.innerHTML = '';
                }

                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const stickerId = `sticker-${Date.now()}-${Math.random()}`;
                        this.stickerData.push({
                            id: stickerId,
                            src: e.target.result,
                            name: file.name
                        });
                        this.createStickerPreview(stickerId, e.target.result);
                    };
                    reader.readAsDataURL(file);
                });
            },

            createStickerPreview(stickerId, src) {
                const container = document.getElementById('sticker-preview-container');
                const previewDiv = document.createElement('div');
                previewDiv.className = 'sticker-preview';
                previewDiv.onclick = () => this.addStickerToCard(stickerId, src);
                
                const img = document.createElement('img');
                img.src = src;
                img.alt = 'sticker';
                
                previewDiv.appendChild(img);
                container.appendChild(previewDiv);
            },

            addStickerToCard(stickerId, src) {
                const fairtle = document.getElementById('fairtle-card');
                const stickerEl = document.createElement('div');
                const placedId = `placed-${Date.now()}-${Math.random()}`;

                const tempImg = new Image();
                tempImg.onload = () => {
                    const aspectRatio = tempImg.width / tempImg.height;
                    const baseSize = 80;
                    const width = aspectRatio > 1 ? baseSize : baseSize * aspectRatio;
                    const height = aspectRatio > 1 ? baseSize / aspectRatio : baseSize;

                    stickerEl.className = 'fairtle-sticker';
                    stickerEl.id = placedId;
                    stickerEl.style.cssText = `left: 100px; top: 100px; width: ${width}px; height: ${height}px;`;
                    stickerEl.dataset.aspectRatio = aspectRatio;

                    const imgEl = document.createElement('img');
                    imgEl.src = src;
                    imgEl.draggable = false;

                    const controlsEl = document.createElement('div');
                    controlsEl.className = 'sticker-controls';
                    controlsEl.innerHTML = `
                        <button class="sticker-delete" onclick="app.removeSticker('${placedId}')" title="ì‚­ì œ">Ã—</button>
                        <button class="sticker-rotate" onmousedown="app.startRotate(event, '${placedId}')" title="ë“œë˜ê·¸í•´ì„œ íšŒì „">â†»</button>
                    `;

                    const resizeEl = document.createElement('div');
                    resizeEl.className = 'resize-handle';
                    resizeEl.onmousedown = (e) => this.startResize(e, placedId);

                    stickerEl.appendChild(imgEl);
                    stickerEl.appendChild(controlsEl);
                    stickerEl.appendChild(resizeEl);

                    stickerEl.onmousedown = (e) => this.startDrag(e, placedId);
                    stickerEl.onclick = (e) => {
                        e.stopPropagation();
                        this.selectSticker(placedId);
                    };

                    fairtle.appendChild(stickerEl);
                    
                    this.placedStickers.push({
                        id: placedId,
                        originalId: stickerId,
                        src: src,
                        x: 100, y: 100,
                        width: width, height: height,
                        aspectRatio: aspectRatio,
                        rotation: 0
                    });

                    this.selectSticker(placedId);
                };
                tempImg.src = src;
            },

            selectSticker(stickerId) {
                document.querySelectorAll('.fairtle-sticker.selected')
                    .forEach(el => el.classList.remove('selected'));
                
                const stickerEl = document.getElementById(stickerId);
                if (stickerEl) {
                    stickerEl.classList.add('selected');
                    this.selectedSticker = stickerId;
                }
            },

            removeSticker(stickerId) {
                const stickerEl = document.getElementById(stickerId);
                if (stickerEl) stickerEl.remove();
                
                this.placedStickers = this.placedStickers.filter(s => s.id !== stickerId);
                
                if (this.selectedSticker === stickerId) {
                    this.selectedSticker = null;
                }
            },

            startDrag(e, stickerId) {
                if (e.target.classList.contains('resize-handle') || 
                    e.target.classList.contains('sticker-delete') ||
                    e.target.classList.contains('sticker-rotate')) return;
                
                e.preventDefault();
                this.isDragging = true;
                this.selectedSticker = stickerId;
                this.selectSticker(stickerId);
                
                const stickerEl = document.getElementById(stickerId);
                const rect = stickerEl.getBoundingClientRect();
                
                this.dragOffset.x = e.clientX - rect.left;
                this.dragOffset.y = e.clientY - rect.top;
            },

            startResize(e, stickerId) {
                e.stopPropagation();
                e.preventDefault();
                this.isResizing = true;
                this.selectedSticker = stickerId;
                this.selectSticker(stickerId);
            },

            handleMouseMove(e) {
                if (this.isDragging && this.selectedSticker) {
                    this.dragSticker(e);
                } else if (this.isResizing && this.selectedSticker) {
                    this.resizeSticker(e);
                } else if (this.isRotating && this.selectedSticker) {
                    this.rotateSticker(e);
                }
            },

            dragSticker(e) {
                const stickerEl = document.getElementById(this.selectedSticker);
                const fairtle = document.getElementById('fairtle-card');
                const fairtleRect = fairtle.getBoundingClientRect();
                
                let newX = e.clientX - fairtleRect.left - this.dragOffset.x;
                let newY = e.clientY - fairtleRect.top - this.dragOffset.y;
                
                newX = Math.max(0, Math.min(newX, fairtle.offsetWidth - stickerEl.offsetWidth));
                newY = Math.max(0, Math.min(newY, fairtle.offsetHeight - stickerEl.offsetHeight));
                
                stickerEl.style.left = newX + 'px';
                stickerEl.style.top = newY + 'px';
                
                const sticker = this.placedStickers.find(s => s.id === this.selectedSticker);
                if (sticker) {
                    sticker.x = newX;
                    sticker.y = newY;
                }
            },

            resizeSticker(e) {
                const stickerEl = document.getElementById(this.selectedSticker);
                const fairtle = document.getElementById('fairtle-card');
                const stickerRect = stickerEl.getBoundingClientRect();
                
                const aspectRatio = parseFloat(stickerEl.dataset.aspectRatio) || 1;
                const startX = parseFloat(stickerEl.style.left);
                const startY = parseFloat(stickerEl.style.top);
                
                let newWidth = e.clientX - stickerRect.left;
                let newHeight = newWidth / aspectRatio;
                
                newWidth = Math.max(20, Math.min(newWidth, 200));
                newHeight = newWidth / aspectRatio;
                
                const maxRight = fairtle.offsetWidth - startX;
                const maxBottom = fairtle.offsetHeight - startY;
                
                if (newWidth > maxRight) {
                    newWidth = maxRight;
                    newHeight = newWidth / aspectRatio;
                }
                if (newHeight > maxBottom) {
                    newHeight = maxBottom;
                    newWidth = newHeight * aspectRatio;
                }
                
                stickerEl.style.width = newWidth + 'px';
                stickerEl.style.height = newHeight + 'px';
                
                const sticker = this.placedStickers.find(s => s.id === this.selectedSticker);
                if (sticker) {
                    sticker.width = newWidth;
                    sticker.height = newHeight;
                }
            },

            handleMouseUp() {
                this.isDragging = false;
                this.isResizing = false;
                this.isRotating = false;
            },

            handleKeyDown(e) {
                if (e.key === 'Delete' && this.selectedSticker) {
                    this.removeSticker(this.selectedSticker);
                }
            },

            handleCardClick(e) {
                if (e.target.id === 'fairtle-card' || !e.target.closest('.fairtle-sticker')) {
                    document.querySelectorAll('.fairtle-sticker.selected')
                        .forEach(el => el.classList.remove('selected'));
                    this.selectedSticker = null;
                }
            },

            // íƒ€ì„ë¼ì¸ ê´€ë ¨
            updateTimelineDisplay() {
                const container = document.getElementById('timeline-container');
                const existingItems = container.querySelectorAll('.timeline-item');
                existingItems.forEach(item => item.remove());

                this.timelineData.forEach((item, index) => {
                    const position = this.timelineData.length === 1 ? 50 : 
                        (index / (this.timelineData.length - 1)) * 100;
                    
                    const itemEl = document.createElement('div');
                    itemEl.className = 'timeline-item';
                    itemEl.style.top = `${position}%`;
                    
                    itemEl.innerHTML = `
                        <div class="timeline-dot"></div>
                        <div class="timeline-date">${item.date}</div>
                        <div class="timeline-title-text">${item.title}</div>
                        <div class="timeline-desc">${item.desc}</div>
                        ${item.image ? `<img src="${item.image}" class="timeline-image" alt="íƒ€ì„ë¼ì¸ ì´ë¯¸ì§€">` : ''}
                    `;
                    
                    container.appendChild(itemEl);
                });

                // íƒ€ì„ë¼ì¸ ì„ ì„ ë§ˆì§€ë§‰ ì•„ì´í…œì— ë§ì¶° ì¡°ì •
                const timeline = container.querySelector('.timeline-line');
                if (timeline && this.timelineData.length > 0) {
                    const lastPosition = this.timelineData.length === 1 ? 50 : 100;
                    timeline.style.height = `${lastPosition}%`;
                }
            },

            updateTimelineForm() {
                const container = document.getElementById('timeline-form-container');
                container.innerHTML = '';
                
                this.timelineData.forEach((item, index) => {
                    const formEl = document.createElement('div');
                    formEl.className = 'timeline-form-item';
                    formEl.innerHTML = `
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="text" class="form-input" placeholder="YYYY-MM" value="${item.date}" 
                                onchange="app.updateTimelineItem(${index}, 'date', this.value)">
                            <input type="text" class="form-input" placeholder="ì œëª©" value="${item.title}" 
                                onchange="app.updateTimelineItem(${index}, 'title', this.value)">
                        </div>
                        <textarea class="form-input form-textarea" placeholder="ì„¤ëª…" 
                            onchange="app.updateTimelineItem(${index}, 'desc', this.value)">${item.desc}</textarea>
                        <input type="file" class="form-input" accept="image/*" 
                            onchange="app.updateTimelineImage(${index}, this)" style="margin-top: 10px;">
                        <button type="button" class="btn-delete" onclick="app.removeTimelineItem(${index})">ì‚­ì œ</button>
                    `;
                    container.appendChild(formEl);
                });
            },

            updateTimelineItem(index, field, value) {
                this.timelineData[index][field] = value;
                this.updateTimelineDisplay();
            },

            updateTimelineImage(index, input) {
                const file = input.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.timelineData[index].image = e.target.result;
                        this.updateTimelineDisplay();
                    };
                    reader.readAsDataURL(file);
                }
            },

            addTimelineItem() {
                this.timelineData.push({
                    date: '2024-01',
                    title: 'ìƒˆ ì´ë²¤íŠ¸',
                    desc: 'ìƒˆë¡œìš´ íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                    image: null
                });
                this.updateTimelineDisplay();
                this.updateTimelineForm();
            },

            removeTimelineItem(index) {
                this.timelineData.splice(index, 1);
                this.updateTimelineDisplay();
                this.updateTimelineForm();
            },

            addExtraSection(charType) {
                const sectionId = `${charType}-extra-${Date.now()}`;
                const sectionData = {
                    id: sectionId,
                    title: 'ìƒˆ ì„¹ì…˜',
                    content: 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                    image: null
                };
                
                this.extraSections[charType].push(sectionData);
                this.updateExtraSections(charType);
                this.updateExtraSectionForm(charType);
            },

            removeExtraSection(charType, sectionId) {
                this.extraSections[charType] = this.extraSections[charType].filter(s => s.id !== sectionId);
                this.updateExtraSections(charType);
                this.updateExtraSectionForm(charType);
            },

            updateExtraSection(charType, sectionId, field, value) {
                const section = this.extraSections[charType].find(s => s.id === sectionId);
                if (section) {
                    section[field] = value;
                    this.updateExtraSections(charType);
                }
            },

            updateExtraSectionImage(charType, sectionId, input) {
                const file = input.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.updateExtraSection(charType, sectionId, 'image', e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            },

            updateExtraSections(charType) {
                const container = document.getElementById(`${charType}-extra-sections`);
                container.innerHTML = '';
                
                this.extraSections[charType].forEach(section => {
                    const sectionEl = document.createElement('div');
                    sectionEl.className = 'detail-section';
                    sectionEl.style.marginTop = '15px';
                    
                    // ê¸€ì´ ìˆëŠ”ì§€ í™•ì¸ (ë¹ˆ ë¬¸ìì—´ì´ë‚˜ ê¸°ë³¸ í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°)
                    const hasContent = section.content && 
                        section.content.trim() !== '' && 
                        section.content !== 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                    
                    let innerHTML = `<div class="detail-title">${section.title}</div>`;
                    
                    if (hasContent) {
                        innerHTML += `<div class="detail-content">${section.content}</div>`;
                    }
                    
                    if (section.image) {
                        const imageStyle = hasContent ? 
                            "width: 100%; height: auto; border-radius: 5px; margin-top: 8px; border: 1px solid #ddd;" :
                            "width: 100%; height: auto; border-radius: 5px; border: 1px solid #ddd;";
                        innerHTML += `<img src="${section.image}" style="${imageStyle}" alt="ì„¹ì…˜ ì´ë¯¸ì§€">`;
                    }
                    
                    sectionEl.innerHTML = innerHTML;
                    container.appendChild(sectionEl);
                });
            },

            updateExtraSectionForm(charType) {
                const formContainer = document.getElementById(`${charType}-extra-form`);
                if (!formContainer) return;
                
                formContainer.innerHTML = '';
                
                this.extraSections[charType].forEach((section, index) => {
                    const formEl = document.createElement('div');
                    formEl.className = 'form-group';
                    formEl.style.cssText = 'border: 1px solid #eee; padding: 15px; margin-bottom: 15px; background: #fafafa;';
                    formEl.innerHTML = `
                        <input type="text" class="form-input" placeholder="ì„¹ì…˜ ì œëª©" value="${section.title}" 
                            onchange="app.updateExtraSection('${charType}', '${section.id}', 'title', this.value)" style="margin-bottom: 10px;">
                        <textarea class="form-input form-textarea" placeholder="ë‚´ìš©" 
                            onchange="app.updateExtraSection('${charType}', '${section.id}', 'content', this.value)">${section.content}</textarea>
                        <input type="file" class="form-input" accept="image/*" 
                            onchange="app.updateExtraSectionImage('${charType}', '${section.id}', this)" style="margin-top: 10px;">
                        <button type="button" class="btn-delete" onclick="app.removeExtraSection('${charType}', '${section.id}')">ì‚­ì œ</button>
                    `;
                    formContainer.appendChild(formEl);
                });
            },

            startRotate(e, stickerId) {
                e.stopPropagation();
                e.preventDefault();
                this.isRotating = true;
                this.selectedSticker = stickerId;
                this.selectSticker(stickerId);
                
                const stickerEl = document.getElementById(stickerId);
                const rect = stickerEl.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                // í˜„ì¬ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì—ì„œ ìŠ¤í‹°ì»¤ ì¤‘ì‹¬ê¹Œì§€ì˜ ê°ë„ ê³„ì‚°
                const deltaX = e.clientX - centerX;
                const deltaY = e.clientY - centerY;
                const currentAngle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
                
                const sticker = this.placedStickers.find(s => s.id === stickerId);
                this.rotateStartAngle = currentAngle - (sticker ? sticker.rotation : 0);
            },

            rotateSticker(e) {
                if (!this.isRotating || !this.selectedSticker) return;
                
                const stickerEl = document.getElementById(this.selectedSticker);
                const rect = stickerEl.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                // í˜„ì¬ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì—ì„œ ê°ë„ ê³„ì‚°
                const deltaX = e.clientX - centerX;
                const deltaY = e.clientY - centerY;
                const currentAngle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
                
                // ìƒˆë¡œìš´ íšŒì „ ê°ë„ ê³„ì‚°
                const newRotation = currentAngle - this.rotateStartAngle;
                
                // ìŠ¤í‹°ì»¤ íšŒì „ ì ìš©
                stickerEl.style.transform = `rotate(${newRotation}deg)`;
                
                // ë°ì´í„° ì—…ë°ì´íŠ¸
                const sticker = this.placedStickers.find(s => s.id === this.selectedSticker);
                if (sticker) {
                    sticker.rotation = newRotation;
                }
            },

            // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
            downloadImage() {
                const selectedElements = document.querySelectorAll('.fairtle-sticker.selected');
                const controlElements = document.querySelectorAll('.sticker-controls, .resize-handle');
                
                selectedElements.forEach(el => el.classList.remove('selected'));
                controlElements.forEach(el => el.style.display = 'none');
                
                const element = document.querySelector('.fairtle-card');
                
                html2canvas(element, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    useCORS: true,
                    allowTaint: true,
                    width: element.offsetWidth,
                    height: element.offsetHeight,
                    scrollX: 0,
                    scrollY: 0
                }).then(canvas => {
                    const link = document.createElement('a');
                    const pairTitle = document.getElementById('pair-title').textContent || 'fairtle';
                    link.download = `${pairTitle}_í˜ì–´í‹€.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    controlElements.forEach(el => el.style.display = '');
                    if (this.selectedSticker) {
                        const stickerEl = document.getElementById(this.selectedSticker);
                        if (stickerEl) stickerEl.classList.add('selected');
                    }
                }).catch(error => {
                    console.error('ì €ì¥ ì‹¤íŒ¨:', error);
                    alert('ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    
                    controlElements.forEach(el => el.style.display = '');
                    if (this.selectedSticker) {
                        const stickerEl = document.getElementById(this.selectedSticker);
                        if (stickerEl) stickerEl.classList.add('selected');
                    }
                });
            }
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•± ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>
