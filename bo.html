<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜ì–´í‹€ ì œì‘ê¸°</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 15px;
            min-width: 1240px;
            overflow-x: auto;
        }

        .fairtle-card {
            background: white;
            border: 1px solid #e1e8ed;
            width: 1200px;
            margin: 0 auto;
            padding: 30px;
            display: grid;
            grid-template-columns: 280px 2fr 280px;
            grid-template-rows: auto auto 1fr;
            gap: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 15px;
            position: relative;
        }

        .pair-header {
            grid-column: 1 / -1;
            text-align: center;
            border-bottom: 2px solid #333;
            padding-bottom: 15px;
        }

        .pair-title {
            font-size: 2.2em;
            font-weight: 700;
            color: #333;
            letter-spacing: 2px;
        }

        .pair-subtitle {
            font-size: 1em;
            color: #666;
            margin-top: 6px;
        }

        .character-profile {
            text-align: center;
            border: 1px solid #eee;
            background: white;
        }

        .character-avatar {
            width: 100%;
            height: 220px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ccc;
            font-size: 0.8em;
            margin-bottom: 15px;
            position: relative;
        }

        /* ì»¬ëŸ¬ì°¨íŠ¸ (ì™¼ìª½ ìƒë‹¨) */
        .color-chart {
            position: absolute;
            top: 10px;
            left: 10px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 3px;
            z-index: 10;
        }

        .color-square {
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-radius: 3px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        .color-square.hair {
            background: #8B4513;
        }

        .color-square.eyes {
            background: #4169E1;
        }

        .color-square.skin {
            background: #FDBCB4;
        }

        /* ì´ëª¨ì§€ ë™ê·¸ë¼ë¯¸ (ì˜¤ë¥¸ìª½ ìƒë‹¨) */
        .emoji-circle {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(128,128,128,0.8);
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        .character-avatar.has-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0) 50%, 
                rgba(255,255,255,0.3) 70%, 
                rgba(255,255,255,1) 100%
            );
            pointer-events: none;
            z-index: 1;
        }

        .profile-content {
            padding: 0 15px 15px 15px;
        }

        .profile-info {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .character-name {
            font-size: 1.6em;
            font-weight: 600;
            color: #333;
            text-align: right;
            flex: 1;
        }

        .character-basic {
            font-size: 0.65em;
            color: #666;
            line-height: 1.3;
            text-align: left;
            flex: 1;
            margin-left: 8px;
        }

        .character-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
            margin-top: 8px;
        }

        .keyword-tag {
            background: #f0f0f0;
            color: #555;
            padding: 3px 8px;
            font-size: 0.65em;
            border: 1px solid #ddd;
        }

        .character-speech {
            margin-top: 15px;
            padding: 12px 15px;
            background: #e0e0e0;
            border-radius: 15px;
            position: relative;
            font-size: 0.8em;
            color: #333;
            line-height: 1.3;
        }

        .character-speech.left::after {
            content: '';
            position: absolute;
            left: -7px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            border-right: 7px solid #e0e0e0;
        }

        .character-speech.right::after {
            content: '';
            position: absolute;
            right: -7px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
            border-left: 7px solid #e0e0e0;
        }

        .character-details {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .detail-section {
            border: 1px solid #eee;
            background: white;
        }

        .detail-title {
            font-size: 0.9em;
            font-weight: 600;
            color: #333;
            padding: 10px 12px;
            background: #f8f8f8;
            border-bottom: 1px solid #eee;
        }

        .detail-content {
            font-size: 0.8em;
            color: #555;
            line-height: 1.6;
            padding: 12px;
            min-height: 100px;
        }

        .timeline-section {
            border: 1px solid #ddd;
            background: white;
            padding: 20px;
        }

        .timeline-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .timeline-container {
            position: relative;
            padding: 20px 0;
        }

        .timeline-line {
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #333;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 40px;
            padding-left: 60px;
        }

        .timeline-dot {
            position: absolute;
            left: 24px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #333;
        }

        .timeline-date {
            font-size: 0.9em;
            font-weight: 600;
            color: white;
            margin-bottom: 4px;
            padding: 3px 8px;
            background: #333;
            display: inline-block;
            border-radius: 3px;
        }

        .timeline-title-text {
            font-size: 0.95em;
            font-weight: 500;
            color: #555;
            margin-bottom: 6px;
        }

        .timeline-desc {
            font-size: 0.8em;
            color: #666;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .timeline-image {
            width: 100%;
            height: auto;
            border-radius: 5px;
            margin-top: 8px;
            border: 1px solid #ddd;
            display: block;
        }

        /* ìŠ¤í‹°ì»¤ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .fairtle-sticker {
            position: absolute;
            cursor: move;
            z-index: 100;
            border: 2px solid transparent;
            user-select: none;
            pointer-events: auto;
        }

        .fairtle-sticker img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            pointer-events: none;
        }

        .fairtle-sticker:hover {
            border-color: #007bff;
        }

        .fairtle-sticker.selected {
            border-color: #007bff;
        }

        .sticker-controls {
            position: absolute;
            top: -8px;
            right: -8px;
            display: none;
        }

        .fairtle-sticker.selected .sticker-controls {
            display: block;
        }

        .sticker-delete {
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 101;
        }

        .resize-handle {
            position: absolute;
            bottom: -8px;
            right: -8px;
            width: 16px;
            height: 16px;
            background: #007bff;
            border: 2px solid white;
            border-radius: 50%;
            cursor: se-resize;
            display: none;
            z-index: 101;
        }

        .fairtle-sticker.selected .resize-handle {
            display: block;
        }

        .edit-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #333;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .download-button {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: #666;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            z-index: 1000;
        }

        .edit-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60vh;
            background: white;
            border-top: 2px solid #333;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 999;
            overflow-y: auto;
        }

        .edit-panel.active {
            transform: translateY(0);
        }

        .edit-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .edit-panel-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
        }

        .edit-content {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            line-height: 1.6;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .sticker-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            min-height: 60px;
            border: 1px dashed #ddd;
            padding: 10px;
            background: #fafafa;
        }

        .sticker-preview {
            position: relative;
            width: 50px;
            height: 50px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            cursor: pointer;
            background: white;
        }

        .sticker-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .sticker-preview:hover {
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <div class="fairtle-card" id="fairtle-card">
        <div class="pair-header">
            <div class="pair-title" id="pair-title">SAMPLE PAIR</div>
            <div class="pair-subtitle" id="pair-subtitle">ìºë¦­í„° A Ã— ìºë¦­í„° B</div>
        </div>
        
        <div class="character-section">
            <div class="character-profile">
                <div class="character-avatar">
                    <div style="position: absolute; top: 10px; left: 10px; z-index: 10;">
                        <div style="width: 20px; height: 20px; background: #8B4513; margin-bottom: 3px; border-radius: 3px; box-shadow: 0 1px 2px rgba(0,0,0,0.2);"></div>
                        <div style="width: 20px; height: 20px; background: #4169E1; margin-bottom: 3px; border-radius: 3px; box-shadow: 0 1px 2px rgba(0,0,0,0.2);"></div>
                        <div style="width: 20px; height: 20px; background: #FDBCB4; border-radius: 3px; box-shadow: 0 1px 2px rgba(0,0,0,0.2);"></div>
                    </div>
                    <div style="position: absolute; top: 10px; right: 10px; width: 35px; height: 35px; background: white; border: 2px solid #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; z-index: 10; box-shadow: 0 1px 2px rgba(0,0,0,0.2);">ğŸ±</div>
                    í”„ë¡œí•„ ì´ë¯¸ì§€
                </div>
                <div class="profile-content">
                    <div class="profile-info">
                        <div class="character-name" id="char1-name">ìºë¦­í„° A</div>
                        <div class="character-basic">
                            <div>ë‚¨ì„± | <span id="char1-age">20</span>ì„¸ | <span id="char1-height">175</span>cm</div>
                            <div id="char1-job">í•™ìƒ</div>
                        </div>
                    </div>
                    <div class="character-keywords" id="char1-keywords">
                        <span class="keyword-tag">ì„±ê²©1</span>
                        <span class="keyword-tag">ì„±ê²©2</span>
                        <span class="keyword-tag">ì„±ê²©3</span>
                    </div>
                    <div class="character-speech left" id="char1-speech">ìºë¦­í„° Aê°€ ìºë¦­í„° Bì—ê²Œ í•˜ëŠ” ë§</div>
                </div>
            </div>
            
            <div class="character-details">
                <div class="detail-section">
                    <div class="detail-title">Backstory</div>
                    <div class="detail-content" id="char1-past">
                        ìºë¦­í„°ì˜ ê³¼ê±° ì´ì•¼ê¸°ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-title">Etc.</div>
                    <div class="detail-content" id="char1-features">
                        ìºë¦­í„°ì˜ ë§ë²„ë¦‡, ë²„ë¦‡, ê¸°íƒ€ ì„¤ì • ë“± ììœ ë¡­ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
                    </div>
                </div>
            </div>
        </div>

        <div class="timeline-section">
            <div class="timeline-title">Timeline</div>
            <div class="timeline-container" id="timeline-container">
                <div class="timeline-line"></div>
                
                <div class="timeline-item" style="top: 0%">
                    <div class="timeline-dot"></div>
                    <div class="timeline-date">1999-06</div>
                    <div class="timeline-title-text">ì²« ë§Œë‚¨</div>
                    <div class="timeline-desc">ìš°ì—°íˆ ê°™ì€ ì¹´í˜ì—ì„œ ë§ˆì£¼ì¹˜ê²Œ ë˜ë©´ì„œ ì‹œì‘ëœ ì¸ì—°</div>
                </div>
                
                <div class="timeline-item" style="top: 30%">
                    <div class="timeline-dot"></div>
                    <div class="timeline-date">2000-03</div>
                    <div class="timeline-title-text">ê°ˆë“±</div>
                    <div class="timeline-desc">ì„œë¡œ ë‹¤ë¥¸ ê°€ì¹˜ê´€ìœ¼ë¡œ ì¸í•œ ì²« ë²ˆì§¸ í° ê°ˆë“±ì´ ë°œìƒ</div>
                </div>
                
                <div class="timeline-item" style="top: 100%">
                    <div class="timeline-dot"></div>
                    <div class="timeline-date">2020-01</div>
                    <div class="timeline-title-text">í™”í•´</div>
                    <div class="timeline-desc">ì˜¤ëœ ì‹œê°„ì´ ì§€ë‚œ í›„ ìš°ì—°íˆ ì¬íšŒí•˜ê²Œ ë˜ë©´ì„œ ìƒˆë¡œìš´ ê´€ê³„ë¥¼ ì‹œì‘</div>
                </div>
            </div>
        </div>

        <div class="character-section">
            <div class="character-profile">
                <div class="character-avatar">
                    <div style="position: absolute; top: 10px; left: 10px; width: 35px; height: 35px; background: white; border: 2px solid #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; z-index: 10; box-shadow: 0 1px 2px rgba(0,0,0,0.2);">ğŸ°</div>
                    <div style="position: absolute; top: 10px; right: 10px; z-index: 10;">
                        <div style="width: 20px; height: 20px; background: #8B4513; margin-bottom: 3px; border-radius: 3px; box-shadow: 0 1px 2px rgba(0,0,0,0.2);"></div>
                        <div style="width: 20px; height: 20px; background: #4169E1; margin-bottom: 3px; border-radius: 3px; box-shadow: 0 1px 2px rgba(0,0,0,0.2);"></div>
                        <div style="width: 20px; height: 20px; background: #FDBCB4; border-radius: 3px; box-shadow: 0 1px 2px rgba(0,0,0,0.2);"></div>
                    </div>
                    í”„ë¡œí•„ ì´ë¯¸ì§€
                </div>
                <div class="profile-content">
                    <div class="profile-info">
                        <div class="character-name" id="char2-name">ìºë¦­í„° B</div>
                        <div class="character-basic">
                            <div>ì—¬ì„± | <span id="char2-age">22</span>ì„¸ | <span id="char2-height">180</span>cm</div>
                            <div id="char2-job">ì§ì¥ì¸</div>
                        </div>
                    </div>
                    <div class="character-keywords" id="char2-keywords">
                        <span class="keyword-tag">ì„±ê²©1</span>
                        <span class="keyword-tag">ì„±ê²©2</span>
                        <span class="keyword-tag">ì„±ê²©3</span>
                    </div>
                    <div class="character-speech right" id="char2-speech">ìºë¦­í„° Bê°€ ìºë¦­í„° Aì—ê²Œ í•˜ëŠ” ë§</div>
                </div>
            </div>
            
            <div class="character-details">
                <div class="detail-section">
                    <div class="detail-title">Backstory</div>
                    <div class="detail-content" id="char2-past">
                        ìºë¦­í„° Bì˜ ê³¼ê±° ì´ì•¼ê¸°ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-title">Etc.</div>
                    <div class="detail-content" id="char2-features">
                        ìºë¦­í„° Bì˜ ë§ë²„ë¦‡, ë²„ë¦‡, ê¸°íƒ€ ì„¤ì • ë“± ììœ ë¡­ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="edit-button" onclick="toggleEdit()">âœï¸</button>
    <button class="download-button" onclick="downloadImage()">ğŸ“¥ ì €ì¥</button>

    <div class="edit-panel" id="edit-panel">
        <div class="edit-panel-header">
            <div class="edit-panel-title">í˜ì–´í‹€ í¸ì§‘</div>
            <button class="close-button" onclick="closeEdit()">Ã—</button>
        </div>
        <div class="edit-content">
            <div class="form-group">
                <label class="form-label">í˜ì–´ëª…</label>
                <input type="text" class="form-input" id="input-pair-title" value="SAMPLE PAIR">
            </div>

            <div class="form-group">
                <label class="form-label">í˜ì–´ ë¶€ì œëª©</label>
                <input type="text" class="form-input" id="input-pair-subtitle" value="ìºë¦­í„° A Ã— ìºë¦­í„° B">
            </div>

            <div class="form-group">
                <label class="form-label">í˜ì–´ ëŒ€í‘œì»¬ëŸ¬</label>
                <input type="color" class="form-input" id="input-pair-color" value="#333333" onchange="updateColors()" style="height: 50px; padding: 5px; cursor: pointer;">
            </div>

            <div class="form-group">
                <label class="form-label">ìŠ¤í‹°ì»¤ ì¶”ê°€</label>
                <input type="file" class="form-input" id="input-sticker-upload" accept="image/*" multiple onchange="handleStickerUpload(this)">
                <div id="sticker-preview-container" class="sticker-preview-container">
                    <div style="width: 100%; text-align: center; color: #999; font-size: 12px;">ìŠ¤í‹°ì»¤ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë˜ê³ , í´ë¦­í•´ì„œ í˜ì–´í‹€ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A ê¸°ë³¸ì •ë³´</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <input type="text" class="form-input" id="input-char1-gender" placeholder="ì„±ë³„" value="ë‚¨ì„±" style="padding: 8px;">
                        <input type="text" class="form-input" id="input-char1-age" placeholder="ë‚˜ì´" value="20" style="padding: 8px;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" class="form-input" id="input-char1-height" placeholder="í‚¤" value="175cm" style="padding: 8px;">
                        <input type="text" class="form-input" id="input-char1-job" placeholder="ì§ì—…" value="í•™ìƒ" style="padding: 8px;">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">B ê¸°ë³¸ì •ë³´</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <input type="text" class="form-input" id="input-char2-gender" placeholder="ì„±ë³„" value="ì—¬ì„±" style="padding: 8px;">
                        <input type="text" class="form-input" id="input-char2-age" placeholder="ë‚˜ì´" value="22" style="padding: 8px;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" class="form-input" id="input-char2-height" placeholder="í‚¤" value="180cm" style="padding: 8px;">
                        <input type="text" class="form-input" id="input-char2-job" placeholder="ì§ì—…" value="ì§ì¥ì¸" style="padding: 8px;">
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A ì„±ê²© í‚¤ì›Œë“œ</label>
                    <input type="text" class="form-input" id="input-char1-keywords" placeholder="ì„±ê²©1, ì„±ê²©2, ì„±ê²©3" value="ì„±ê²©1, ì„±ê²©2, ì„±ê²©3">
                </div>
                <div class="form-group">
                    <label class="form-label">B ì„±ê²© í‚¤ì›Œë“œ</label>
                    <input type="text" class="form-input" id="input-char2-keywords" placeholder="ì„±ê²©1, ì„±ê²©2, ì„±ê²©3" value="ì„±ê²©1, ì„±ê²©2, ì„±ê²©3">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A ê³¼ê±°</label>
                    <textarea class="form-input form-textarea" id="input-char1-past" placeholder="ìºë¦­í„°ì˜ ê³¼ê±° ì´ì•¼ê¸°">ìºë¦­í„°ì˜ ê³¼ê±° ì´ì•¼ê¸°ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">B ê³¼ê±°</label>
                    <textarea class="form-input form-textarea" id="input-char2-past" placeholder="ìºë¦­í„°ì˜ ê³¼ê±° ì´ì•¼ê¸°">ìºë¦­í„° Bì˜ ê³¼ê±° ì´ì•¼ê¸°ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A íŠ¹ì§•</label>
                    <textarea class="form-input form-textarea" id="input-char1-features" placeholder="ìºë¦­í„°ì˜ íŠ¹ì§•ì´ë‚˜ ìŠµê´€">ìºë¦­í„°ì˜ ë…íŠ¹í•œ íŠ¹ì§•ì´ë‚˜ ìŠµê´€, ë²„ë¦‡ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">B íŠ¹ì§•</label>
                    <textarea class="form-input form-textarea" id="input-char2-features" placeholder="ìºë¦­í„°ì˜ íŠ¹ì§•ì´ë‚˜ ìŠµê´€">ìºë¦­í„° Bì˜ ë…íŠ¹í•œ íŠ¹ì§•ì´ë‚˜ ìŠµê´€, ë²„ë¦‡ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A í”„ë¡œí•„ ì´ë¯¸ì§€</label>
                    <input type="file" class="form-input" id="input-char1-image" accept="image/*" onchange="handleImageUpload('char1', this)">
                </div>
                <div class="form-group">
                    <label class="form-label">B í”„ë¡œí•„ ì´ë¯¸ì§€</label>
                    <input type="file" class="form-input" id="input-char2-image" accept="image/*" onchange="handleImageUpload('char2', this)">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A â†’ B í•œë§ˆë””</label>
                    <textarea class="form-input form-textarea" id="input-char1-speech">í•œë§ˆë””, í˜¸ì¹­ ë“±</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">B â†’ A í•œë§ˆë””</label>
                    <textarea class="form-input form-textarea" id="input-char2-speech">í•œë§ˆë””, í˜¸ì¹­ ë“±</textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A ì»¬ëŸ¬ì°¨íŠ¸</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 5px;">
                        <div style="flex: 1; min-width: 50px;">
                            <input type="color" class="form-input" id="input-char1-hair" value="#8B4513" onchange="updateCharacterColors()" style="width: 100%; height: 40px; padding: 0; min-width: 50px;">
                            <div style="font-size: 11px; color: #666; text-align: center; margin-top: 2px;">ë¨¸ë¦¬</div>
                        </div>
                        <div style="flex: 1; min-width: 50px;">
                            <input type="color" class="form-input" id="input-char1-eyes" value="#4169E1" onchange="updateCharacterColors()" style="width: 100%; height: 40px; padding: 0; min-width: 50px;">
                            <div style="font-size: 11px; color: #666; text-align: center; margin-top: 2px;">ëˆˆ</div>
                        </div>
                        <div style="flex: 1; min-width: 50px;">
                            <input type="color" class="form-input" id="input-char1-skin" value="#FDBCB4" onchange="updateCharacterColors()" style="width: 100%; height: 40px; padding: 0; min-width: 50px;">
                            <div style="font-size: 11px; color: #666; text-align: center; margin-top: 2px;">í”¼ë¶€</div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">B ì»¬ëŸ¬ì°¨íŠ¸</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 5px;">
                        <div style="flex: 1; min-width: 50px;">
                            <input type="color" class="form-input" id="input-char2-hair" value="#8B4513" onchange="updateCharacterColors()" style="width: 100%; height: 40px; padding: 0; min-width: 50px;">
                            <div style="font-size: 11px; color: #666; text-align: center; margin-top: 2px;">ë¨¸ë¦¬</div>
                        </div>
                        <div style="flex: 1; min-width: 50px;">
                            <input type="color" class="form-input" id="input-char2-eyes" value="#4169E1" onchange="updateCharacterColors()" style="width: 100%; height: 40px; padding: 0; min-width: 50px;">
                            <div style="font-size: 11px; color: #666; text-align: center; margin-top: 2px;">ëˆˆ</div>
                        </div>
                        <div style="flex: 1; min-width: 50px;">
                            <input type="color" class="form-input" id="input-char2-skin" value="#FDBCB4" onchange="updateCharacterColors()" style="width: 100%; height: 40px; padding: 0; min-width: 50px;">
                            <div style="font-size: 11px; color: #666; text-align: center; margin-top: 2px;">í”¼ë¶€</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">A ì´ëª¨ì§€</label>
                    <input type="text" class="form-input" id="input-char1-emoji" value="ğŸ±" onchange="updateEmojis()" maxlength="2" style="text-align: center; font-size: 18px;">
                </div>
                <div class="form-group">
                    <label class="form-label">B ì´ëª¨ì§€</label>
                    <input type="text" class="form-input" id="input-char2-emoji" value="ğŸ°" onchange="updateEmojis()" maxlength="2" style="text-align: center; font-size: 18px;">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">íƒ€ì„ë¼ì¸ í¸ì§‘</label>
                <div id="timeline-form-container">
                    <div class="timeline-form-item" style="border: 1px solid #eee; padding: 15px; margin-bottom: 15px; background: #fafafa;">
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="text" class="form-input" placeholder="YYYY-MM" value="1999-06" onchange="updateTimelineItem(0, 'date', this.value)">
                            <input type="text" class="form-input" placeholder="ì œëª©" value="ì²« ë§Œë‚¨" onchange="updateTimelineItem(0, 'title', this.value)">
                        </div>
                        <textarea class="form-input form-textarea" placeholder="ì„¤ëª…" onchange="updateTimelineItem(0, 'desc', this.value)">ìš°ì—°íˆ ê°™ì€ ì¹´í˜ì—ì„œ ë§ˆì£¼ì¹˜ê²Œ ë˜ë©´ì„œ ì‹œì‘ëœ ì¸ì—°</textarea>
                        <input type="file" class="form-input" accept="image/*" onchange="updateTimelineImage(0, this)" style="margin-top: 10px;">
                        <button type="button" onclick="removeTimelineItem(0)" style="background: #ff4444; color: white; border: none; padding: 5px 10px; font-size: 12px; margin-top: 10px;">ì‚­ì œ</button>
                    </div>

                    <div class="timeline-form-item" style="border: 1px solid #eee; padding: 15px; margin-bottom: 15px; background: #fafafa;">
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="text" class="form-input" placeholder="YYYY-MM" value="2000-03" onchange="updateTimelineItem(1, 'date', this.value)">
                            <input type="text" class="form-input" placeholder="ì œëª©" value="ê°ˆë“±" onchange="updateTimelineItem(1, 'title', this.value)">
                        </div>
                        <textarea class="form-input form-textarea" placeholder="ì„¤ëª…" onchange="updateTimelineItem(1, 'desc', this.value)">ì„œë¡œ ë‹¤ë¥¸ ê°€ì¹˜ê´€ìœ¼ë¡œ ì¸í•œ ì²« ë²ˆì§¸ í° ê°ˆë“±ì´ ë°œìƒ</textarea>
                        <input type="file" class="form-input" accept="image/*" onchange="updateTimelineImage(1, this)" style="margin-top: 10px;">
                        <button type="button" onclick="removeTimelineItem(1)" style="background: #ff4444; color: white; border: none; padding: 5px 10px; font-size: 12px; margin-top: 10px;">ì‚­ì œ</button>
                    </div>

                    <div class="timeline-form-item" style="border: 1px solid #eee; padding: 15px; margin-bottom: 15px; background: #fafafa;">
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="text" class="form-input" placeholder="YYYY-MM" value="2020-01" onchange="updateTimelineItem(2, 'date', this.value)">
                            <input type="text" class="form-input" placeholder="ì œëª©" value="í™”í•´" onchange="updateTimelineItem(2, 'title', this.value)">
                        </div>
                        <textarea class="form-input form-textarea" placeholder="ì„¤ëª…" onchange="updateTimelineItem(2, 'desc', this.value)">ì˜¤ëœ ì‹œê°„ì´ ì§€ë‚œ í›„ ìš°ì—°íˆ ì¬íšŒí•˜ê²Œ ë˜ë©´ì„œ ìƒˆë¡œìš´ ê´€ê³„ë¥¼ ì‹œì‘</textarea>
                        <input type="file" class="form-input" accept="image/*" onchange="updateTimelineImage(2, this)" style="margin-top: 10px;">
                        <button type="button" onclick="removeTimelineItem(2)" style="background: #ff4444; color: white; border: none; padding: 5px 10px; font-size: 12px; margin-top: 10px;">ì‚­ì œ</button>
                    </div>
                </div>
                <button type="button" onclick="addTimelineItem()" style="width: 100%; padding: 10px; background: #f0f0f0; border: 1px solid #ddd; margin-top: 10px;">+ íƒ€ì„ë¼ì¸ ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        let timelineData = [
            { date: '1999-06', title: 'ì²« ë§Œë‚¨', desc: 'ìš°ì—°íˆ ê°™ì€ ì¹´í˜ì—ì„œ ë§ˆì£¼ì¹˜ê²Œ ë˜ë©´ì„œ ì‹œì‘ëœ ì¸ì—°', image: null },
            { date: '2000-03', title: 'ê°ˆë“±', desc: 'ì„œë¡œ ë‹¤ë¥¸ ê°€ì¹˜ê´€ìœ¼ë¡œ ì¸í•œ ì²« ë²ˆì§¸ í° ê°ˆë“±ì´ ë°œìƒ', image: null },
            { date: '2020-01', title: 'í™”í•´', desc: 'ì˜¤ëœ ì‹œê°„ì´ ì§€ë‚œ í›„ ìš°ì—°íˆ ì¬íšŒí•˜ê²Œ ë˜ë©´ì„œ ìƒˆë¡œìš´ ê´€ê³„ë¥¼ ì‹œì‘', image: null }
        ];

        let stickerData = []; // ì—…ë¡œë“œëœ ìŠ¤í‹°ì»¤ë“¤
        let placedStickers = []; // í˜ì–´í‹€ì— ë°°ì¹˜ëœ ìŠ¤í‹°ì»¤ë“¤
        let selectedSticker = null;
        let isDragging = false;
        let isResizing = false;
        let dragOffset = { x: 0, y: 0 };

        function toggleEdit() {
            const panel = document.getElementById('edit-panel');
            if (panel.classList.contains('active')) {
                panel.classList.remove('active');
            } else {
                panel.classList.add('active');
                updateInputs();
            }
        }

        function closeEdit() {
            const panel = document.getElementById('edit-panel');
            panel.classList.remove('active');
        }

        function updateInputs() {
            document.getElementById('input-pair-title').value = document.getElementById('pair-title').textContent;
            document.getElementById('input-pair-subtitle').value = document.getElementById('pair-subtitle').textContent;
            document.getElementById('input-char1-name').value = document.getElementById('char1-name').textContent;
            document.getElementById('input-char2-name').value = document.getElementById('char2-name').textContent;
            document.getElementById('input-char1-speech').value = document.getElementById('char1-speech').textContent;
            document.getElementById('input-char2-speech').value = document.getElementById('char2-speech').textContent;
            
            // ê¸°ë³¸ì •ë³´ ì—…ë°ì´íŠ¸
            const char1Age = document.getElementById('char1-age').textContent;
            const char1Height = document.getElementById('char1-height').textContent;
            const char1Job = document.getElementById('char1-job').textContent;
            const char2Age = document.getElementById('char2-age').textContent;
            const char2Height = document.getElementById('char2-height').textContent;
            const char2Job = document.getElementById('char2-job').textContent;
            
            document.getElementById('input-char1-age').value = char1Age;
            document.getElementById('input-char1-height').value = char1Height + 'cm';
            document.getElementById('input-char1-job').value = char1Job;
            document.getElementById('input-char2-age').value = char2Age;
            document.getElementById('input-char2-height').value = char2Height + 'cm';
            document.getElementById('input-char2-job').value = char2Job;
            
            // í‚¤ì›Œë“œ, ê³¼ê±°, íŠ¹ì§• ì—…ë°ì´íŠ¸
            document.getElementById('input-char1-keywords').value = Array.from(document.getElementById('char1-keywords').querySelectorAll('.keyword-tag')).map(tag => tag.textContent).join(', ');
            document.getElementById('input-char2-keywords').value = Array.from(document.getElementById('char2-keywords').querySelectorAll('.keyword-tag')).map(tag => tag.textContent).join(', ');
            document.getElementById('input-char1-past').value = document.getElementById('char1-past').textContent;
            document.getElementById('input-char2-past').value = document.getElementById('char2-past').textContent;
            document.getElementById('input-char1-features').value = document.getElementById('char1-features').textContent;
            document.getElementById('input-char2-features').value = document.getElementById('char2-features').textContent;
        }

        function updatePreview() {
            document.getElementById('pair-title').textContent = document.getElementById('input-pair-title').value;
            document.getElementById('pair-subtitle').textContent = document.getElementById('input-pair-subtitle').value;
            document.getElementById('char1-name').textContent = document.getElementById('input-char1-name').value;
            document.getElementById('char2-name').textContent = document.getElementById('input-char2-name').value;
            document.getElementById('char1-speech').textContent = document.getElementById('input-char1-speech').value;
            document.getElementById('char2-speech').textContent = document.getElementById('input-char2-speech').value;
            
            // ê¸°ë³¸ì •ë³´ ì—…ë°ì´íŠ¸
            const char1Gender = document.getElementById('input-char1-gender').value;
            const char1Age = document.getElementById('input-char1-age').value;
            const char1Height = document.getElementById('input-char1-height').value;
            const char1Job = document.getElementById('input-char1-job').value;
            
            const char2Gender = document.getElementById('input-char2-gender').value;
            const char2Age = document.getElementById('input-char2-age').value;
            const char2Height = document.getElementById('input-char2-height').value;
            const char2Job = document.getElementById('input-char2-job').value;
            
            // ìºë¦­í„° A ê¸°ë³¸ì •ë³´ ì—…ë°ì´íŠ¸
            const char1BasicEl = document.querySelector('#char1-name').closest('.profile-info').querySelector('.character-basic');
            char1BasicEl.innerHTML = `<div>${char1Gender} | <span id="char1-age">${char1Age}</span>ì„¸ | <span id="char1-height">${char1Height.replace('cm', '')}</span>cm</div><div id="char1-job">${char1Job}</div>`;
            
            // ìºë¦­í„° B ê¸°ë³¸ì •ë³´ ì—…ë°ì´íŠ¸
            const char2BasicEl = document.querySelector('#char2-name').closest('.profile-info').querySelector('.character-basic');
            char2BasicEl.innerHTML = `<div>${char2Gender} | <span id="char2-age">${char2Age}</span>ì„¸ | <span id="char2-height">${char2Height.replace('cm', '')}</span>cm</div><div id="char2-job">${char2Job}</div>`;
            
            // í‚¤ì›Œë“œ ì—…ë°ì´íŠ¸
            updateKeywords('char1', document.getElementById('input-char1-keywords').value);
            updateKeywords('char2', document.getElementById('input-char2-keywords').value);
            
            // ê³¼ê±°/íŠ¹ì§• ì—…ë°ì´íŠ¸
            document.getElementById('char1-past').textContent = document.getElementById('input-char1-past').value;
            document.getElementById('char2-past').textContent = document.getElementById('input-char2-past').value;
            document.getElementById('char1-features').textContent = document.getElementById('input-char1-features').value;
            document.getElementById('char2-features').textContent = document.getElementById('input-char2-features').value;
        }

        function updateKeywords(charType, keywordsText) {
            const keywordsContainer = document.getElementById(`${charType}-keywords`);
            const keywords = keywordsText.split(',').map(k => k.trim()).filter(k => k);
            
            keywordsContainer.innerHTML = '';
            keywords.forEach(keyword => {
                const tag = document.createElement('span');
                tag.className = 'keyword-tag';
                tag.textContent = keyword;
                keywordsContainer.appendChild(tag);
            });
        }

        // ìŠ¤í‹°ì»¤ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleStickerUpload(input) {
            const files = input.files;
            const container = document.getElementById('sticker-preview-container');
            
            if (stickerData.length === 0) {
                container.innerHTML = '';
            }
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const stickerId = `sticker-${Date.now()}-${Math.random()}`;
                    stickerData.push({
                        id: stickerId,
                        src: e.target.result,
                        name: file.name
                    });
                    
                    createStickerPreview(stickerId, e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        // ìŠ¤í‹°ì»¤ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
        function createStickerPreview(stickerId, src) {
            const container = document.getElementById('sticker-preview-container');
            const previewDiv = document.createElement('div');
            previewDiv.className = 'sticker-preview';
            previewDiv.onclick = () => addStickerToCard(stickerId, src);
            
            const img = document.createElement('img');
            img.src = src;
            img.alt = 'sticker';
            
            previewDiv.appendChild(img);
            container.appendChild(previewDiv);
        }

        // í˜ì–´í‹€ ì¹´ë“œì— ìŠ¤í‹°ì»¤ ì¶”ê°€
        function addStickerToCard(stickerId, src) {
            const fairtle = document.getElementById('fairtle-card');
            const stickerEl = document.createElement('div');
            const placedId = `placed-${Date.now()}-${Math.random()}`;
            
            // ì´ë¯¸ì§€ ë¯¸ë¦¬ ë¡œë“œí•˜ì—¬ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
            const tempImg = new Image();
            tempImg.crossOrigin = "anonymous";
            tempImg.onload = function() {
                const aspectRatio = this.width / this.height;
                const baseSize = 80;
                let width, height;
                
                if (aspectRatio > 1) {
                    width = baseSize;
                    height = baseSize / aspectRatio;
                } else {
                    width = baseSize * aspectRatio;
                    height = baseSize;
                }
                
                stickerEl.className = 'fairtle-sticker';
                stickerEl.id = placedId;
                stickerEl.style.left = '100px';
                stickerEl.style.top = '100px';
                stickerEl.style.width = width + 'px';
                stickerEl.style.height = height + 'px';
                stickerEl.style.zIndex = '100';
                stickerEl.dataset.aspectRatio = aspectRatio;
                
                // ë” ì•ˆì „í•œ HTML êµ¬ì¡°
                const imgEl = document.createElement('img');
                imgEl.src = src;
                imgEl.style.cssText = 'width: 100%; height: 100%; object-fit: contain; display: block; pointer-events: none;';
                imgEl.draggable = false;
                
                const controlsEl = document.createElement('div');
                controlsEl.className = 'sticker-controls';
                controlsEl.innerHTML = `<button class="sticker-delete" onclick="removeSticker('${placedId}')" title="ì‚­ì œ">Ã—</button>`;
                
                const resizeEl = document.createElement('div');
                resizeEl.className = 'resize-handle';
                resizeEl.onmousedown = (e) => startResize(e, placedId);
                
                stickerEl.appendChild(imgEl);
                stickerEl.appendChild(controlsEl);
                stickerEl.appendChild(resizeEl);
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                stickerEl.onmousedown = (e) => startDrag(e, placedId);
                stickerEl.onclick = (e) => {
                    e.stopPropagation();
                    selectSticker(placedId);
                };
                
                fairtle.appendChild(stickerEl);
                
                placedStickers.push({
                    id: placedId,
                    originalId: stickerId,
                    src: src,
                    x: 100,
                    y: 100,
                    width: width,
                    height: height,
                    aspectRatio: aspectRatio
                });
                
                selectSticker(placedId);
                
                // ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ í›„ ê°•ì œ ë¦¬í˜ì¸íŠ¸
                setTimeout(() => {
                    stickerEl.style.display = 'block';
                }, 10);
            };
            
            tempImg.onerror = function() {
                console.error('ìŠ¤í‹°ì»¤ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', src);
                alert('ìŠ¤í‹°ì»¤ ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            };
            
            tempImg.src = src;
        }

        // ìŠ¤í‹°ì»¤ ì„ íƒ
        function selectSticker(stickerId) {
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            document.querySelectorAll('.fairtle-sticker.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            // ìƒˆë¡œìš´ ìŠ¤í‹°ì»¤ ì„ íƒ
            const stickerEl = document.getElementById(stickerId);
            if (stickerEl) {
                stickerEl.classList.add('selected');
                selectedSticker = stickerId;
            }
        }

        // ë“œë˜ê·¸ ì‹œì‘
        function startDrag(e, stickerId) {
            if (e.target.classList.contains('resize-handle') || e.target.classList.contains('sticker-delete')) {
                return;
            }
            
            e.preventDefault();
            isDragging = true;
            selectedSticker = stickerId;
            selectSticker(stickerId);
            
            const stickerEl = document.getElementById(stickerId);
            const rect = stickerEl.getBoundingClientRect();
            const fairtle = document.getElementById('fairtle-card');
            const fairtleRect = fairtle.getBoundingClientRect();
            
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
        }

        // ë¦¬ì‚¬ì´ì¦ˆ ì‹œì‘
        function startResize(e, stickerId) {
            e.stopPropagation();
            e.preventDefault();
            isResizing = true;
            selectedSticker = stickerId;
            selectSticker(stickerId);
        }

        // ë§ˆìš°ìŠ¤ ì´ë™ ì´ë²¤íŠ¸
        document.addEventListener('mousemove', (e) => {
            if (isDragging && selectedSticker) {
                const stickerEl = document.getElementById(selectedSticker);
                const fairtle = document.getElementById('fairtle-card');
                const fairtleRect = fairtle.getBoundingClientRect();
                
                let newX = e.clientX - fairtleRect.left - dragOffset.x;
                let newY = e.clientY - fairtleRect.top - dragOffset.y;
                
                // ê²½ê³„ ì²´í¬
                newX = Math.max(0, Math.min(newX, fairtle.offsetWidth - stickerEl.offsetWidth));
                newY = Math.max(0, Math.min(newY, fairtle.offsetHeight - stickerEl.offsetHeight));
                
                stickerEl.style.left = newX + 'px';
                stickerEl.style.top = newY + 'px';
                
                // placedStickers ë°°ì—´ ì—…ë°ì´íŠ¸
                const sticker = placedStickers.find(s => s.id === selectedSticker);
                if (sticker) {
                    sticker.x = newX;
                    sticker.y = newY;
                }
            } else if (isResizing && selectedSticker) {
                const stickerEl = document.getElementById(selectedSticker);
                const fairtle = document.getElementById('fairtle-card');
                const stickerRect = stickerEl.getBoundingClientRect();
                
                // ì›ë³¸ ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ í¬ê¸° ì¡°ì ˆ
                const aspectRatio = parseFloat(stickerEl.dataset.aspectRatio) || 1;
                const startX = parseFloat(stickerEl.style.left);
                const startY = parseFloat(stickerEl.style.top);
                
                let newWidth = e.clientX - stickerRect.left;
                let newHeight = newWidth / aspectRatio;
                
                // ìµœì†Œ/ìµœëŒ€ í¬ê¸° ì œí•œ
                newWidth = Math.max(20, Math.min(newWidth, 200));
                newHeight = newWidth / aspectRatio;
                
                // í˜ì–´í‹€ ê²½ê³„ ì²´í¬
                const maxRight = fairtle.offsetWidth - startX;
                const maxBottom = fairtle.offsetHeight - startY;
                
                if (newWidth > maxRight) {
                    newWidth = maxRight;
                    newHeight = newWidth / aspectRatio;
                }
                if (newHeight > maxBottom) {
                    newHeight = maxBottom;
                    newWidth = newHeight * aspectRatio;
                }
                
                stickerEl.style.width = newWidth + 'px';
                stickerEl.style.height = newHeight + 'px';
                
                // placedStickers ë°°ì—´ ì—…ë°ì´íŠ¸
                const sticker = placedStickers.find(s => s.id === selectedSticker);
                if (sticker) {
                    sticker.width = newWidth;
                    sticker.height = newHeight;
                }
            }
        });

        // ë§ˆìš°ìŠ¤ ì—… ì´ë²¤íŠ¸
        document.addEventListener('mouseup', () => {
            isDragging = false;
            isResizing = false;
        });

        // í˜ì–´í‹€ ì¹´ë“œ í´ë¦­ì‹œ ìŠ¤í‹°ì»¤ ì„ íƒ í•´ì œ
        document.getElementById('fairtle-card').addEventListener('click', (e) => {
            if (e.target.id === 'fairtle-card' || e.target.closest('.fairtle-sticker') === null) {
                document.querySelectorAll('.fairtle-sticker.selected').forEach(el => {
                    el.classList.remove('selected');
                });
                selectedSticker = null;
            }
        });

        // ìŠ¤í‹°ì»¤ ì‚­ì œ
        function removeSticker(stickerId) {
            const stickerEl = document.getElementById(stickerId);
            if (stickerEl) {
                stickerEl.remove();
            }
            
            placedStickers = placedStickers.filter(s => s.id !== stickerId);
            
            if (selectedSticker === stickerId) {
                selectedSticker = null;
            }
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (Delete í‚¤ë¡œ ì„ íƒëœ ìŠ¤í‹°ì»¤ ì‚­ì œ)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Delete' && selectedSticker) {
                removeSticker(selectedSticker);
            }
        });

        function handleImageUpload(charType, input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const avatarElement = document.querySelector(`#char${charType === 'char1' ? '1' : '2'}-name`).closest('.character-profile').querySelector('.character-avatar');
                    avatarElement.style.backgroundImage = `url(${e.target.result})`;
                    avatarElement.style.backgroundSize = 'cover';
                    avatarElement.style.backgroundPosition = 'center';
                    
                    const textNodes = Array.from(avatarElement.childNodes).filter(node => node.nodeType === 3);
                    textNodes.forEach(node => node.remove());
                    
                    avatarElement.classList.add('has-image');
                };
                reader.readAsDataURL(file);
            }
        }

        function updateColors() {
            const color = document.getElementById('input-pair-color').value;
            
            const hexToRgb = (hex) => {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? {
                    r: parseInt(result[1], 16),
                    g: parseInt(result[2], 16),
                    b: parseInt(result[3], 16)
                } : null;
            };
            
            const rgb = hexToRgb(color);
            const lightColor = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.1)`;
            const speechColor = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.2)`;
            const borderColor = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.5)`;
            
            const dots = document.querySelectorAll('.timeline-dot');
            const dates = document.querySelectorAll('.timeline-date');
            const line = document.querySelector('.timeline-line');
            
            dots.forEach(dot => {
                dot.style.backgroundColor = color;
                dot.style.boxShadow = `0 0 0 2px ${color}`;
            });
            
            dates.forEach(date => {
                date.style.backgroundColor = color;
            });
            
            if (line) {
                line.style.backgroundColor = color;
            }

            const keywords = document.querySelectorAll('.keyword-tag');
            keywords.forEach(keyword => {
                keyword.style.backgroundColor = lightColor;
            });

            const speeches = document.querySelectorAll('.character-speech');
            speeches.forEach(speech => {
                speech.style.backgroundColor = speechColor;
                
                const oldStyleId = speech.getAttribute('data-style-index');
                if (oldStyleId) {
                    const oldStyle = document.getElementById(`speech-style-${oldStyleId}`);
                    if (oldStyle) oldStyle.remove();
                }
                
                const newIndex = Date.now() + Math.random();
                speech.setAttribute('data-style-index', newIndex);
                
                const afterStyle = document.createElement('style');
                afterStyle.id = `speech-style-${newIndex}`;
                
                if (speech.classList.contains('left')) {
                    afterStyle.textContent = `
                        .character-speech[data-style-index="${newIndex}"]::after {
                            border-right-color: ${speechColor} !important;
                        }
                    `;
                } else {
                    afterStyle.textContent = `
                        .character-speech[data-style-index="${newIndex}"]::after {
                            border-left-color: ${speechColor} !important;
                        }
                    `;
                }
                document.head.appendChild(afterStyle);
            });

            const detailTitles = document.querySelectorAll('.detail-title');
            detailTitles.forEach(title => {
                title.style.backgroundColor = lightColor;
            });

            // í˜ì–´ í—¤ë” êµ¬ë¶„ì„  ìƒ‰ìƒ ë³€ê²½
            const pairHeader = document.querySelector('.pair-header');
            if (pairHeader) {
                pairHeader.style.borderBottomColor = color;
            }
            avatars.forEach(avatar => {
                const emojiCircles = avatar.querySelectorAll('div[style*="border-radius: 50%"]');
                emojiCircles.forEach(circle => {
                    let style = circle.getAttribute('style');
                    style = style.replace(/border: 2px solid [^;]+;/, `border: 2px solid ${borderColor};`);
                    style = style.replace(/background: [^;]+;/, `background: white;`);
                    circle.setAttribute('style', style);
                });
            });
        }

        function updateTimelineItem(index, field, value) {
            timelineData[index][field] = value;
            updateTimelineDisplay();
        }

        function updateTimelineImage(index, input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    timelineData[index].image = e.target.result;
                    updateTimelineDisplay();
                };
                reader.readAsDataURL(file);
            }
        }

        function updateTimelineDisplay() {
            const container = document.getElementById('timeline-container');
            const timeline = container.querySelector('.timeline-line');
            
            const items = container.querySelectorAll('.timeline-item');
            items.forEach(item => item.remove());
            
            timelineData.forEach((item, index) => {
                const position = timelineData.length === 1 ? 50 : (index / (timelineData.length - 1)) * 100;
                
                const itemEl = document.createElement('div');
                itemEl.className = 'timeline-item';
                itemEl.style.top = `${position}%`;
                
                const color = document.getElementById('input-pair-color').value;
                
                itemEl.innerHTML = `
                    <div class="timeline-dot" style="background-color: ${color}; box-shadow: 0 0 0 2px ${color};"></div>
                    <div class="timeline-date" style="background-color: ${color};">${item.date}</div>
                    <div class="timeline-title-text">${item.title}</div>
                    <div class="timeline-desc">${item.desc}</div>
                    ${item.image ? `<img src="${item.image}" class="timeline-image" alt="íƒ€ì„ë¼ì¸ ì´ë¯¸ì§€">` : ''}
                `;
                
                container.appendChild(itemEl);
            });
        }

        function addTimelineItem() {
            timelineData.push({
                date: '2024-01',
                title: 'ìƒˆ ì´ë²¤íŠ¸',
                desc: 'ìƒˆë¡œìš´ íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
                image: null
            });
            updateTimelineDisplay();
            updateTimelineForm();
        }

        function removeTimelineItem(index) {
            timelineData.splice(index, 1);
            updateTimelineDisplay();
            updateTimelineForm();
        }

        function updateTimelineForm() {
            const container = document.getElementById('timeline-form-container');
            container.innerHTML = '';
            
            timelineData.forEach((item, index) => {
                const formEl = document.createElement('div');
                formEl.className = 'timeline-form-item';
                formEl.style.cssText = 'border: 1px solid #eee; padding: 15px; margin-bottom: 15px; background: #fafafa;';
                formEl.innerHTML = `
                    <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; margin-bottom: 10px;">
                        <input type="text" class="form-input" placeholder="YYYY-MM" value="${item.date}" onchange="updateTimelineItem(${index}, 'date', this.value)">
                        <input type="text" class="form-input" placeholder="ì œëª©" value="${item.title}" onchange="updateTimelineItem(${index}, 'title', this.value)">
                    </div>
                    <textarea class="form-input form-textarea" placeholder="ì„¤ëª…" onchange="updateTimelineItem(${index}, 'desc', this.value)">${item.desc}</textarea>
                    <input type="file" class="form-input" accept="image/*" onchange="updateTimelineImage(${index}, this)" style="margin-top: 10px;">
                    <button type="button" onclick="removeTimelineItem(${index})" style="background: #ff4444; color: white; border: none; padding: 5px 10px; font-size: 12px; margin-top: 10px;">ì‚­ì œ</button>
                `;
                container.appendChild(formEl);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('input-pair-title').addEventListener('input', updatePreview);
            document.getElementById('input-pair-subtitle').addEventListener('input', updatePreview);
            document.getElementById('input-char1-name').addEventListener('input', updatePreview);
            document.getElementById('input-char2-name').addEventListener('input', updatePreview);
            document.getElementById('input-char1-speech').addEventListener('input', updatePreview);
            document.getElementById('input-char2-speech').addEventListener('input', updatePreview);
            
            // ê¸°ë³¸ì •ë³´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.getElementById('input-char1-gender').addEventListener('input', updatePreview);
            document.getElementById('input-char1-age').addEventListener('input', updatePreview);
            document.getElementById('input-char1-height').addEventListener('input', updatePreview);
            document.getElementById('input-char1-job').addEventListener('input', updatePreview);
            document.getElementById('input-char2-gender').addEventListener('input', updatePreview);
            document.getElementById('input-char2-age').addEventListener('input', updatePreview);
            document.getElementById('input-char2-height').addEventListener('input', updatePreview);
            document.getElementById('input-char2-job').addEventListener('input', updatePreview);
            
            // í‚¤ì›Œë“œ, ê³¼ê±°, íŠ¹ì§• ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.getElementById('input-char1-keywords').addEventListener('input', updatePreview);
            document.getElementById('input-char2-keywords').addEventListener('input', updatePreview);
            document.getElementById('input-char1-past').addEventListener('input', updatePreview);
            document.getElementById('input-char2-past').addEventListener('input', updatePreview);
            document.getElementById('input-char1-features').addEventListener('input', updatePreview);
            document.getElementById('input-char2-features').addEventListener('input', updatePreview);
        });

        function updateCharacterColors() {
            const char1Hair = document.getElementById('input-char1-hair').value;
            const char1Eyes = document.getElementById('input-char1-eyes').value;
            const char1Skin = document.getElementById('input-char1-skin').value;
            const char2Hair = document.getElementById('input-char2-hair').value;
            const char2Eyes = document.getElementById('input-char2-eyes').value;
            const char2Skin = document.getElementById('input-char2-skin').value;
            
            // ëª¨ë“  character-avatar ì°¾ê¸°
            const avatars = document.querySelectorAll('.character-avatar');
            
            if (avatars.length >= 2) {
                // ì²« ë²ˆì§¸ ìºë¦­í„° (ì™¼ìª½)
                const char1Avatar = avatars[0];
                // 20px í¬ê¸°ì˜ divë“¤ì„ ì°¾ê¸° (ì»¬ëŸ¬ì°¨íŠ¸)
                const char1AllDivs = char1Avatar.querySelectorAll('div');
                const char1ColorDivs = Array.from(char1AllDivs).filter(div => {
                    const style = div.getAttribute('style') || '';
                    return style.includes('width: 20px') && style.includes('height: 20px');
                });
                
                if (char1ColorDivs.length >= 3) {
                    // ìˆœì„œëŒ€ë¡œ ë¨¸ë¦¬, ëˆˆ, í”¼ë¶€
                    const hair1 = char1ColorDivs[0];
                    const eyes1 = char1ColorDivs[1];
                    const skin1 = char1ColorDivs[2];
                    
                    // ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€í•˜ë©´ì„œ ë°°ê²½ìƒ‰ë§Œ ë³€ê²½
                    let hairStyle = hair1.getAttribute('style');
                    hairStyle = hairStyle.replace(/background:\s*[^;]+/g, `background: ${char1Hair}`);
                    hair1.setAttribute('style', hairStyle);
                    
                    let eyesStyle = eyes1.getAttribute('style');
                    eyesStyle = eyesStyle.replace(/background:\s*[^;]+/g, `background: ${char1Eyes}`);
                    eyes1.setAttribute('style', eyesStyle);
                    
                    let skinStyle = skin1.getAttribute('style');
                    skinStyle = skinStyle.replace(/background:\s*[^;]+/g, `background: ${char1Skin}`);
                    skin1.setAttribute('style', skinStyle);
                }
                
                // ë‘ ë²ˆì§¸ ìºë¦­í„° (ì˜¤ë¥¸ìª½)
                const char2Avatar = avatars[1];
                const char2AllDivs = char2Avatar.querySelectorAll('div');
                const char2ColorDivs = Array.from(char2AllDivs).filter(div => {
                    const style = div.getAttribute('style') || '';
                    return style.includes('width: 20px') && style.includes('height: 20px');
                });
                
                if (char2ColorDivs.length >= 3) {
                    // ìˆœì„œëŒ€ë¡œ ë¨¸ë¦¬, ëˆˆ, í”¼ë¶€
                    const hair2 = char2ColorDivs[0];
                    const eyes2 = char2ColorDivs[1];
                    const skin2 = char2ColorDivs[2];
                    
                    let hairStyle = hair2.getAttribute('style');
                    hairStyle = hairStyle.replace(/background:\s*[^;]+/g, `background: ${char2Hair}`);
                    hair2.setAttribute('style', hairStyle);
                    
                    let eyesStyle = eyes2.getAttribute('style');
                    eyesStyle = eyesStyle.replace(/background:\s*[^;]+/g, `background: ${char2Eyes}`);
                    eyes2.setAttribute('style', eyesStyle);
                    
                    let skinStyle = skin2.getAttribute('style');
                    skinStyle = skinStyle.replace(/background:\s*[^;]+/g, `background: ${char2Skin}`);
                    skin2.setAttribute('style', skinStyle);
                }
            }
        }

        function updateEmojis() {
            const char1Emoji = document.getElementById('input-char1-emoji').value;
            const char2Emoji = document.getElementById('input-char2-emoji').value;
            
            const avatars = document.querySelectorAll('.character-avatar');
            if (avatars.length >= 2) {
                const char1EmojiCircle = avatars[0].querySelector('div[style*="border-radius: 50%"]');
                const char2EmojiCircle = avatars[1].querySelector('div[style*="border-radius: 50%"]');
                
                if (char1EmojiCircle) char1EmojiCircle.textContent = char1Emoji;
                if (char2EmojiCircle) char2EmojiCircle.textContent = char2Emoji;
            }
        }

        function downloadImage() {
            // ìŠ¤í‹°ì»¤ ì„ íƒ ìƒíƒœì™€ ì»¨íŠ¸ë¡¤ ìš”ì†Œë“¤ ì„ì‹œ ìˆ¨ê¹€
            const selectedElements = document.querySelectorAll('.fairtle-sticker.selected');
            const controlElements = document.querySelectorAll('.sticker-controls, .resize-handle');
            
            selectedElements.forEach(el => el.classList.remove('selected'));
            controlElements.forEach(el => el.style.display = 'none');
            
            const element = document.querySelector('.fairtle-card');
            
            html2canvas(element, {
                scale: 2,
                backgroundColor: '#ffffff',
                useCORS: true,
                allowTaint: true,
                width: element.offsetWidth,
                height: element.offsetHeight,
                scrollX: 0,
                scrollY: 0
            }).then(canvas => {
                const link = document.createElement('a');
                const pairTitle = document.getElementById('pair-title').textContent || 'fairtle';
                link.download = `${pairTitle}_í˜ì–´í‹€.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // ì„ íƒ ìƒíƒœì™€ ì»¨íŠ¸ë¡¤ ìš”ì†Œë“¤ ë³µì›
                controlElements.forEach(el => el.style.display = '');
                if (selectedSticker) {
                    const stickerEl = document.getElementById(selectedSticker);
                    if (stickerEl) stickerEl.classList.add('selected');
                }
            }).catch(error => {
                console.error('ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                
                // ì—ëŸ¬ì‹œì—ë„ ì»¨íŠ¸ë¡¤ ìš”ì†Œë“¤ ë³µì›
                controlElements.forEach(el => el.style.display = '');
                if (selectedSticker) {
                    const stickerEl = document.getElementById(selectedSticker);
                    if (stickerEl) stickerEl.classList.add('selected');
                }
            });
        }
    </script>
</body>
</html>