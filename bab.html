<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ëŠ˜ì˜ ê¸‰ì‹ ìƒì„±ê¸°</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f0f0f0; min-height: 100vh; }
        .container { display: flex; min-height: 100vh; }
        .controls { background: white; padding: 25px; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .result-wrapper { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 50px; position: relative; gap: 10px; }
        .pair-name { position: absolute; top: 20px; right: 120px; z-index: 5; font-size: 14px; font-weight: 500; opacity: 0.7; }
        .control-group { margin-bottom: 20px; }
        .control-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 15px; }
        textarea.input-field { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; min-height: 200px; resize: none; overflow: hidden; }
        .button-group { display: flex; justify-content: center; gap: 8px; margin-top: 20px; }
        .btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; }
        .btn-primary { background: #007aff; color: white; } .btn-danger { background: #dc3545; color: white; }
        .lunch-tray-area { position: relative; width: 600px; height: 400px; background: url('https://i.imgur.com/j1ePEU9.png') center/contain no-repeat; }
        .food-placeholder { position: absolute; display: flex; align-items: center; justify-content: center; font-size: 50px; }
        .speech-bubble { position: absolute; background: white; border: 2px solid #ddd; padding: 10px 14px; font-size: 12px; font-weight: 500; color: #333; box-shadow: 0 2px 8px rgba(0,0,0,0.1); z-index: 10; max-width: 240px; text-align: center; }
        .speech-bubble.left { top: 18px; left: -2px; border-radius: 15px 15px 15px 5px; }
        .speech-bubble.right { bottom: 38px; right: -8px; border-radius: 15px 15px 5px 15px; }
        #food-1 { top: 16%; left: 21%; width: 80px; height: 80px; } 
        #food-2 { top: 16%; left: 36%; width: 80px; height: 80px; }
        #food-3 { top: 16%; left: 51%; width: 80px; height: 80px; } 
        #food-4 { top: 16%; left: 67%; width: 80px; height: 80px; }
        #food-5 { top: 40%; left: 25%; width: 150px; height: 150px; font-size: 108px; } 
        #food-6 { top: 40%; left: 56%; width: 150px; height: 150px; font-size: 108px; }
        .review-card-area { width: 100%; max-width: 550px; background: #ffffff; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.12); overflow: hidden; position: relative; }
        .info-header { background-color: #f1f3f5; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; }
        .info-header .date { font-size: 16px; font-weight: 600; color: #333; }
        .info-header .calories { font-size: 14px; font-weight: 500; color: #e54d42; background-color: #fef4f4; padding: 4px 10px; border-radius: 20px; }
        .content-area { padding: 20px; }
        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; }
        .grid-item { background-color: #f8f9fa; border-radius: 8px; padding: 12px; text-align: center; }
        .grid-item .icon { font-size: 24px; color: #007aff; margin-bottom: 5px; }
        .grid-item .menu-name { font-size: 13px; font-weight: 600; color: #333; }
        .grid-item .category { font-size: 11px; color: #888; }
        .review-box { display: flex; align-items: center; gap: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px; position: relative; overflow: visible; }
        .review-box .stars { font-size: 24px; color: #ffd700; }
        .review-box .stars .empty { color: #dcdcdc; }
        .review-box .review-text { font-size: 13px; line-height: 1.6; flex: 1; color: #444; padding-right: 70px; }
        .meokjjang-stamp { position: absolute; top: 40%; right: 10px; transform: translateY(-50%) rotate(15deg) scale(0.8); width: 50px; height: 50px; opacity: 0; transition: all 0.3s ease; border: 2px solid #ff6b6b; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; color: #ff6b6b; background: white; z-index: 10; }
        .meokjjang-stamp::before { content: "ë¨¹ì§±"; }
        .meokjjang-stamp.show { opacity: 0.85; transform: translateY(-50%) rotate(-10deg) scale(1); }
        .popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; justify-content: center; align-items: center; }
        .popup { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 500px; width: 90%; }
        .popup h3 { margin-bottom: 15px; } .popup textarea { width: 100%; height: 250px; font-family: monospace; font-size: 12px; border: 1px solid #ddd; border-radius: 5px; padding: 10px; }
        .popup-buttons { margin-top: 15px; text-align: right; } .popup-buttons button { margin-left: 10px; }
        
        /* í° ìµœì í™” - ëª¨ë“  ìš”ì†Œ í¬ê¸°/ìœ„ì¹˜ ê³ ì •, ê°€ë¡œ ìŠ¤í¬ë¡¤ ì²˜ë¦¬ */
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .controls { padding: 15px; }
            .result-wrapper { padding: 20px; overflow-x: auto; }
            /* ëª¨ë“  ìš”ì†Œ í¬ê¸°/ìœ„ì¹˜/í°íŠ¸ ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€ */
            /* .lunch-tray-area: 600x400 ê³ ì • */
            /* .review-card-area: 550px ê³ ì • */
            /* .speech-bubble: ì›ë³¸ í¬ê¸°/ìœ„ì¹˜/í°íŠ¸ ê³ ì • */
            /* .pair-name: ì›ë³¸ ìœ„ì¹˜/í°íŠ¸ ê³ ì • */
            textarea.input-field { min-height: 150px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <h2>ê¸‰ì‹íŒ ìƒì„±ê¸°</h2>
            <div class="control-group">
                <label>ëª…ë ¹ì–´ ë¶™ì—¬ë„£ê¸° <i class="fa-solid fa-pen-to-square" onclick="openCommandHelp()" style="cursor: pointer;"></i></label>
                <textarea class="input-field" id="commandInput" placeholder="ì´ê³³ì— AIê°€ ìƒì„±í•œ ëª…ë ¹ì–´ë¥¼ ë¶™ì—¬ë„£ìœ¼ë©´ ëª¨ë“  ë‚´ìš©ì´ í•œ ë²ˆì— ì ìš©ë©ë‹ˆë‹¤." oninput="autoResize(this); parseAndRenderAll()"></textarea>
            </div>
            <div class="button-group">
                <button class="btn btn-danger" onclick="clearAll()">ì´ˆê¸°í™”</button>
                <button class="btn btn-primary" onclick="takeScreenshot()">ìŠ¤í¬ë¦°ìƒ·</button>
            </div>
        </div>

        <div class="result-wrapper" id="resultWrapper">
            <div class="pair-name" id="pairName"></div>
            <div class="lunch-tray-area">
                <div class="speech-bubble left" id="leftSpeech">ì˜ë¨¹ê² ìŠµë‹ˆë‹¤!</div>
                <div class="speech-bubble right" id="rightSpeech">ë§›ìˆê² ë‹¤~</div>
                <div class="food-placeholder" id="food-1"></div>
                <div class="food-placeholder" id="food-2"></div>
                <div class="food-placeholder" id="food-3"></div>
                <div class="food-placeholder" id="food-4"></div>
                <div class="food-placeholder" id="food-5"></div>
                <div class="food-placeholder" id="food-6"></div>
            </div>
            <div class="review-card-area">
                <div class="info-header">
                    <span class="date" id="reviewDate"></span>
                    <span class="calories" id="reviewCalories"></span>
                </div>
                <div class="content-area">
                    <div class="menu-grid" id="menuGrid"></div>
                    <div class="review-box">
                        <div class="stars" id="reviewStars"></div>
                        <div class="review-text" id="reviewText"></div>
                        <div class="meokjjang-stamp" id="meokjjangStamp1"></div>
                    </div>
                    <div class="review-box">
                        <div class="stars" id="reviewStars2"></div>
                        <div class="review-text" id="reviewText2"></div>
                        <div class="meokjjang-stamp" id="meokjjangStamp2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="popup-overlay" id="popupOverlay">
        <div class="popup">
            <h3>ëª…ë ¹ì–´ ê°€ì´ë“œ</h3>
            <textarea readonly>[oocëª¨ë“œ - ë¡¤í”Œ ì ì‹œ ì¤‘ì§€]
ìºë¦­í„°ì™€ ìœ ì €ëŠ” ê³ ë“±í•™ìƒì´ë©° ì˜¤ëŠ˜ ë¨¹ì€ í•™êµê¸‰ì‹ ë©”ë‰´ë¥¼ ì–‘ì‹ì— ë§ê²Œ ì¶œë ¥í•œë‹¤.

[{ìºë¦­í„° í—¥ìŠ¤ì½”ë“œ}][{ìœ ì € í—¥ìŠ¤ì½”ë“œ}]
[{í˜ì–´ëª…}]
[{YYYY-MM-DD ìš”ì¼}]
[ì´ëª¨ì§€: {ë””ì €íŠ¸}, {ë¶€ìš”ë¦¬}, {ì£¼ìš”ë¦¬}, {ìŒë£Œ}, {ì£¼ì‹}, {êµ­ë¬¼}]
[ë©”ë‰´ëª…:{ë””ì €íŠ¸}, {ë¶€ìš”ë¦¬}, {ì£¼ìš”ë¦¬}, {ìŒë£Œ}, {ì£¼ì‹}, {êµ­ë¬¼}]
[{ì¹¼ë¡œë¦¬}]

[{ìºë¦­í„° ì‹ì „ì¸ì‚¬}] [{ìœ ì € ì‹ì „ì¸ì‚¬}]
[ìºë¦­í„° ë³„ì :{1-5}] [{í›„ê¸°}]
[ìœ ì € ë³„ì :{1-5}] [{í›„ê¸°}]</textarea>ë‰´ë¥¼ ì–‘ì‹ì— ë§ê²Œ ì¶œë ¥í•œë‹¤.

[{ìºë¦­í„° í—¥ìŠ¤ì½”ë“œ}][{ìœ ì € í—¥ìŠ¤ì½”ë“œ}]
[{í˜ì–´ëª…}]
[{YYYY-MM-DD ìš”ì¼}]
[ì´ëª¨ì§€: {ê³¼ì¼}, {ë¶€ìš”ë¦¬}, {ì£¼ìš”ë¦¬}, {ìŒë£Œ}, {ì£¼ì‹}, {êµ­ë¬¼}]
[ë©”ë‰´ëª…:{ê³¼ì¼}, {ë¶€ìš”ë¦¬}, {ì£¼ìš”ë¦¬}, {ìŒë£Œ}, {ì£¼ì‹}, {êµ­ë¬¼}]
[{ì¹¼ë¡œë¦¬}]

[{ìºë¦­í„° ì‹ì „ì¸ì‚¬}] [{ìœ ì € ì‹ì „ì¸ì‚¬}]
[ìºë¦­í„° ë³„ì :{1-5}] [{í›„ê¸°}]
[ìœ ì € ë³„ì :{1-5}] [{í›„ê¸°}]</textarea>
            <div class="popup-buttons">
                <button class="btn btn-danger" onclick="closeCommandHelp()">ë‹«ê¸°</button>
                <button class="btn btn-primary" onclick="copyCommandTemplate()">ë³µì‚¬</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.max(200, textarea.scrollHeight) + 'px';
        }
        
        function parseAndRenderAll() {
            const command = document.getElementById('commandInput').value;
            
            // ëª¨ë“  [] ë‚´ìš©ì„ ìˆœì„œëŒ€ë¡œ ì¶”ì¶œ
            const allBrackets = command.match(/\[([^\]]+)\]/g);
            if (!allBrackets) return;
            
            const items = allBrackets.map(item => item.slice(1, -1)); // [] ì œê±°
            
            // ìˆœì„œëŒ€ë¡œ í• ë‹¹
            const charColor = items[0] || '';
            const userColor = items[1] || '';
            const pairName = items[2] || '';
            const dateVal = items[3] || '';
            const emojiStr = (items[4] || '').replace('ì´ëª¨ì§€:', '').trim();
            const menuStr = (items[5] || '').replace('ë©”ë‰´ëª…:', '').trim();
            const caloriesStr = (items[6] || '').replace(/Kcal|kcal|ì¹¼ë¡œë¦¬/gi, '').trim();
            const leftSpeech = items[7] || 'ì˜ë¨¹ê² ìŠµë‹ˆë‹¤!';
            const rightSpeech = items[8] || 'ë§›ìˆê² ë‹¤~';
            
            // ë³„ì /í›„ê¸° ì°¾ê¸°
            let charRating = 0;
            let charReview = '';
            let userRating = 0;
            let userReview = '';
            
            for (let i = 9; i < items.length; i++) {
                if (items[i].includes('ë³„ì :')) {
                    let rating = 0;
                    
                    // ìˆ«ì í˜•íƒœ (ë³„ì :5 ë˜ëŠ” ë°•ë´‰íŒ” ë³„ì :5)
                    const numberMatch = items[i].match(/ë³„ì :\s*([1-5])/);
                    if (numberMatch) {
                        rating = parseInt(numberMatch[1]);
                    } 
                    // ë³„ í˜•íƒœ (ë³„ì :â˜…â˜…â˜…â˜…â˜† ë˜ëŠ” ë°•ë´‰íŒ” ë³„ì : â˜…â˜…â˜…â˜…â˜†)
                    else {
                        const starMatch = items[i].match(/ë³„ì :\s*(â˜…*â˜†*)/);
                        if (starMatch) {
                            const stars = starMatch[1];
                            const fullStars = (stars.match(/â˜…/g) || []).length;
                            const halfStars = (stars.match(/â˜†/g) || []).length;
                            rating = fullStars + (halfStars * 0.5);
                        }
                    }
                    
                    const review = (items[i + 1] || '').replace(/^í›„ê¸°:\s*/, '');
                    
                    if (charRating === 0) {
                        charRating = rating;
                        charReview = review;
                    } else {
                        userRating = rating;
                        userReview = review;
                        break;
                    }
                }
                // ë³„ì  ì—†ì´ ì§ì ‘ ë³„ë§Œ ìˆëŠ” ê²½ìš° (â˜…â˜…â˜…â˜…â˜†)
                else if (items[i].match(/^â˜…*â˜†*$/)) {
                    const stars = items[i];
                    const fullStars = (stars.match(/â˜…/g) || []).length;
                    const halfStars = (stars.match(/â˜†/g) || []).length;
                    const rating = fullStars + (halfStars * 0.5);
                    const review = (items[i + 1] || '').replace(/^í›„ê¸°:\s*/, '');
                    
                    if (charRating === 0) {
                        charRating = rating;
                        charReview = review;
                    } else {
                        userRating = rating;
                        userReview = review;
                        break;
                    }
                }
            }
            
            // ì ìš©
            // ë°°ê²½: ì²«ë²ˆì§¸ ìƒ‰ìƒ
            if (charColor.includes('#')) {
                document.getElementById('resultWrapper').style.backgroundColor = charColor;
                
                // í˜ì–´ëª… ìƒ‰ìƒ ì¡°ì •
                const r = parseInt(charColor.slice(1, 3), 16);
                const g = parseInt(charColor.slice(3, 5), 16);
                const b = parseInt(charColor.slice(5, 7), 16);
                const brightness = (r * 299 + g * 587 + b * 114) / 1000;
                document.getElementById('pairName').style.color = brightness > 128 ? '#333' : '#fff';
            }
            
            // í˜ì–´ëª…
            document.getElementById('pairName').textContent = pairName;
            
            // ë‚ ì§œ
            let formattedDate = '----. --. --.';
            if (dateVal) {
                const parts = dateVal.split(' ');
                if (parts.length >= 2) {
                    const datePart = parts[0];
                    const dayPart = parts[1];
                    const dateComponents = datePart.split('-');
                    if (dateComponents.length === 3) {
                        const year = dateComponents[0];
                        const month = dateComponents[1] === 'XX' ? 'XX' : parseInt(dateComponents[1], 10);
                        const day = dateComponents[2] === 'XX' ? 'XX' : parseInt(dateComponents[2], 10);
                        formattedDate = `${year}. ${month}. ${day}. ${dayPart}`;
                    }
                }
            }
            document.getElementById('reviewDate').textContent = formattedDate;
            document.getElementById('reviewCalories').textContent = caloriesStr + ' Kcal';
            
            // ì´ëª¨ì§€ (ì½¤ë§ˆë“  ê³µë°±ì´ë“  ì¸ì‹)
            const emojis = emojiStr.split(/[\s,]+/).filter(e => e.trim());
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`food-${i}`).textContent = emojis[i-1] || '';
            }
            
            // ë©”ë‰´ ê·¸ë¦¬ë“œ
            const menuGrid = document.getElementById('menuGrid');
            menuGrid.innerHTML = '';
            
            if (menuStr) {
                const categories = ['ë””ì €íŠ¸', 'ë¶€ìš”ë¦¬', 'ì£¼ìš”ë¦¬', 'ìŒë£Œ', 'ì£¼ì‹', 'êµ­ë¬¼'];
                let menuItems = [];
                
                // {} í˜•íƒœ ë˜ëŠ” ì½¤ë§ˆ êµ¬ë¶„ í˜•íƒœ ë‘˜ ë‹¤ ì§€ì›
                if (menuStr.includes('{')) {
                    // {ë©”ë‰´ëª…} í˜•íƒœ
                    menuItems = menuStr.match(/\{([^}]+)\}/g) || [];
                    menuItems = menuItems.map(item => item.replace(/[{}]/g, ''));
                } else {
                    // ì½¤ë§ˆ êµ¬ë¶„ í˜•íƒœ - ì½¤ë§ˆë¡œë§Œ êµ¬ë¶„í•˜ê³  ê³µë°±ì€ ë³´ì¡´
                    menuItems = menuStr.split(',').map(item => item.trim()).filter(item => item);
                }
                
                categories.forEach((category, index) => {
                    if (menuItems[index]) {
                        const menuName = menuItems[index].trim();
                        const icon = emojis[index] || 'ğŸ—’ï¸';
                        
                        const gridItem = document.createElement('div');
                        gridItem.className = 'grid-item';
                        gridItem.innerHTML = `
                            <div class="icon">${icon}</div>
                            <div class="menu-name">${menuName}</div>
                            <div class="category">${category}</div>
                        `;
                        menuGrid.appendChild(gridItem);
                    }
                });
            }
            
            // ë§í’ì„ ê³¼ í‘œ: ë‘ë²ˆì§¸ ìƒ‰ìƒ (ë” ë°ê²Œ)
            if (userColor && userColor.includes('#')) {
                const r = parseInt(userColor.slice(1, 3), 16);
                const g = parseInt(userColor.slice(3, 5), 16);
                const b = parseInt(userColor.slice(5, 7), 16);
                
                // ë§í’ì„ ì€ í°ìƒ‰ ìœ ì§€
                document.getElementById('leftSpeech').style.backgroundColor = 'white';
                document.getElementById('rightSpeech').style.backgroundColor = 'white';
                
                // ê·¸ë¦¬ë“œ 15%
                const gridR = Math.round(248 * 0.85 + r * 0.15);
                const gridG = Math.round(249 * 0.85 + g * 0.15);
                const gridB = Math.round(250 * 0.85 + b * 0.15);
                document.querySelectorAll('.grid-item').forEach(item => {
                    item.style.backgroundColor = `rgb(${gridR}, ${gridG}, ${gridB})`;
                });
                
                // í—¤ë” 20%
                const headerR = Math.round(241 * 0.8 + r * 0.2);
                const headerG = Math.round(243 * 0.8 + g * 0.2);
                const headerB = Math.round(245 * 0.8 + b * 0.2);
                document.querySelector('.info-header').style.backgroundColor = `rgb(${headerR}, ${headerG}, ${headerB})`;
                
                // í›„ê¸° ë°•ìŠ¤ 5%
                const reviewR = Math.round(248 * 0.95 + r * 0.05);
                const reviewG = Math.round(249 * 0.95 + g * 0.05);
                const reviewB = Math.round(250 * 0.95 + b * 0.05);
                document.querySelectorAll('.review-box').forEach(box => {
                    box.style.backgroundColor = `rgb(${reviewR}, ${reviewG}, ${reviewB})`;
                });
            }
            
            // ë§í’ì„  í…ìŠ¤íŠ¸
            document.getElementById('leftSpeech').textContent = leftSpeech;
            document.getElementById('rightSpeech').textContent = rightSpeech;
            
            // ë³„ì 
            function renderStars(elementId, rating) {
                const starsEl = document.getElementById(elementId);
                starsEl.innerHTML = '';
                for (let i = 1; i <= 5; i++) {
                    if (rating >= i) starsEl.innerHTML += '<i class="fa-solid fa-star"></i>';
                    else if (rating >= i - 0.5) starsEl.innerHTML += '<i class="fa-solid fa-star-half-stroke"></i>';
                    else starsEl.innerHTML += '<i class="fa-regular fa-star empty"></i>';
                }
            }
            
            renderStars('reviewStars', charRating);
            renderStars('reviewStars2', userRating);
            
            // í›„ê¸°
            document.getElementById('reviewText').textContent = charReview;
            document.getElementById('reviewText2').textContent = userReview;
            
            // ë¨¹ì§± ìŠ¤íƒ¬í”„
            document.getElementById('meokjjangStamp1').classList.toggle('show', charRating === 5);
            document.getElementById('meokjjangStamp2').classList.toggle('show', userRating === 5);
        }

        function clearAll() {
            document.getElementById('commandInput').value = '';
            parseAndRenderAll();
        }
        
        async function takeScreenshot() {
            window.scrollTo(0, 0);
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const element = document.getElementById('resultWrapper');
            
            // ìŠ¤í¬ë¦°ìƒ·ìš© ì„ì‹œ ìŠ¤íƒ€ì¼ ì ìš©
            const originalStyle = {
                width: element.style.width,
                height: element.style.height,
                transform: element.style.transform
            };
            
            // ê°•ì œë¡œ ê³ ì • í¬ê¸° ì ìš© (ë°ìŠ¤í¬í†± ê¸°ì¤€)
            element.style.width = '1200px';
            element.style.height = '800px';
            element.style.transform = 'scale(1)';
            
            // ê¸‰ì‹íŒê³¼ í‘œë„ ê°•ì œë¡œ ì›ë³¸ í¬ê¸° ì ìš©
            const lunchTray = element.querySelector('.lunch-tray-area');
            const reviewCard = element.querySelector('.review-card-area');
            
            const originalLunchStyle = {
                width: lunchTray.style.width,
                height: lunchTray.style.height
            };
            const originalReviewStyle = {
                width: reviewCard.style.width
            };
            
            lunchTray.style.width = '600px';
            lunchTray.style.height = '400px';
            reviewCard.style.width = '550px';
            
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const canvas = await html2canvas(element, {
                allowTaint: true,
                useCORS: true,
                scale: 2,
                backgroundColor: '#ffffff',
                width: 1200,
                height: 800
            });
            
            // ì›ë³¸ ìŠ¤íƒ€ì¼ ë³µì›
            element.style.width = originalStyle.width;
            element.style.height = originalStyle.height;
            element.style.transform = originalStyle.transform;
            lunchTray.style.width = originalLunchStyle.width;
            lunchTray.style.height = originalLunchStyle.height;
            reviewCard.style.width = originalReviewStyle.width;
            
            // ì—¬ë°± ìë¥´ê¸°
            const croppedCanvas = document.createElement('canvas');
            const ctx = croppedCanvas.getContext('2d');
            
            const cropTop = 20;
            const cropLeft = 200;
            const cropWidth = canvas.width - (cropLeft * 2);
            const cropHeight = canvas.height - (cropTop * 2);
            
            croppedCanvas.width = cropWidth;
            croppedCanvas.height = cropHeight;
            
            ctx.drawImage(canvas, cropLeft, cropTop, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
            
            const link = document.createElement('a');
            link.download = 'ê¸‰ì‹íŒ_' + new Date().toISOString().slice(0, 10) + '.png';
            link.href = croppedCanvas.toDataURL();
            link.click();
        }

        function openCommandHelp() { document.getElementById('popupOverlay').style.display = 'flex'; }
        function closeCommandHelp() { document.getElementById('popupOverlay').style.display = 'none'; }
        function copyCommandTemplate() {
            const template = document.querySelector('.popup textarea').value;
            navigator.clipboard.writeText(template).then(() => alert('ëª…ë ¹ì–´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'), () => alert('ë³µì‚¬ ì‹¤íŒ¨'));
        }

        document.addEventListener('DOMContentLoaded', () => {
             document.getElementById('popupOverlay').addEventListener('click', e => { if (e.target === e.currentTarget) closeCommandHelp(); });
            clearAll();
        });
    </script>
</body>
</html>
