<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìºë¦­í„° ì†Œê°œ & í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: #1a1a1a;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }
        
        .container { display: flex; height: 100vh; }
        
        .preview-panel {
            width: calc(50% + 20px);
            flex: none;
            background: #2a2a2a;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #444;
        }

        body.prompt-mode .preview-panel {
            padding: 0;
            overflow: hidden;
            position: relative;
        }

        body.prompt-mode .panel-title {
            display: none;
        }
        
        .editor-panel {
            width: calc(50% - 20px);
            flex: 1;
            background: #1e1e1e;
            padding: 20px;
            overflow-y: auto;
            min-width: 0;
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #fff;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #444;
        }

        .editor-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .mode-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #932;
            transition: .4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #667eea;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .form-group { margin-bottom: 15px; }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            color: #fff;
            font-size: 13px;
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
            line-height: 1.5;
        }
        
        .form-group textarea.large { min-height: 200px; }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #932;
            box-shadow: 0 0 0 2px rgba(153, 51, 34, 0.2);
        }
        
        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .tag {
            background: #932;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tag-remove { cursor: pointer; font-weight: bold; }
        .add-tag-input { flex: 1; min-width: 120px; }
        
        .color-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .color-input input[type="color"] {
            width: 40px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .profile-preview {
            width: 100%;
            margin: 0;
        }
        
        .copy-button {
            background: #932;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 20px;
            width: 100%;
        }
        
        .copy-button:hover { background: #a43; }
        .copy-button.prompt { background: #667eea; }
        .copy-button.prompt:hover { background: #5a6fd8; }
        
        .presets { margin-bottom: 20px; }
        
        .preset-button {
            background: #444;
            color: #fff;
            border: 1px solid #666;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .preset-button:hover { background: #555; }
        
        .preset-button.add-preset {
            background: #667eea;
            border-color: #5a6fd8;
        }
        
        .preset-button.add-preset:hover {
            background: #5a6fd8;
        }
        
        .preset-button.custom {
            background: #2d5a27;
            border-color: #4a7c59;
            position: relative;
            padding-right: 30px;
        }
        
        .preset-button.custom:hover {
            background: #4a7c59;
        }
        
        .preset-delete {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #ff6b6b;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preset-delete:hover {
            color: #ff5252;
        }
        
        .section-divider {
            margin: 20px 0;
            border-top: 1px solid #444;
            padding-top: 15px;
        }
        
        .char-counter {
            text-align: right;
            color: #888;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .char-counter.warning { color: #ff6b6b; }

        .format-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .format-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .format-btn:hover { background: #555; }
        
        .quick-insert {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .quick-btn {
            background: #932;
            color: #fff;
            border: none;
            padding: 5px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .quick-btn:hover { background: #a43; }

        .profile-only { display: block; }
        .prompt-only { display: none; }

        body.prompt-mode .profile-only { display: none; }
        body.prompt-mode .prompt-only { display: block; }

        .character-image-only {
            position: relative;
            width: 100%;
            height: 100vh;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #2a2a2a;
        }

        .character-image-only::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                transparent 0%, 
                transparent 40%, 
                rgba(0, 0, 0, 0.3) 70%, 
                rgba(0, 0, 0, 0.8) 100%);
            z-index: 1;
        }

        .character-namecard {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 2;
            padding: 20px 24px;
            height: 120px;
        }

        .character-name {
            position: absolute;
            bottom: 60px;
            left: 24px;
            right: 24px;
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
            color: white;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.9);
            letter-spacing: -0.5px;
            word-break: break-word;
            line-height: 1.2;
        }

        .character-details {
            position: absolute;
            bottom: 32px;
            left: 24px;
            right: 24px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.7);
            line-height: 1.3;
            margin: 0;
        }

        .character-image-only .no-image {
            color: #888;
            font-size: 16px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
            text-align: center;
            padding: 20px;
        }

        /* ëª¨ë°”ì¼ íƒ­ ë²„íŠ¼ */
        .mobile-tabs {
            display: none;
            background: #1e1e1e;
            padding: 10px;
            border-bottom: 1px solid #444;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .tab-button {
            background: #333;
            color: #ccc;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .tab-button.active {
            background: #932;
            color: #fff;
        }
        
        .tab-button:hover {
            background: #555;
        }
        
        .tab-button.active:hover {
            background: #a43;
        }

        /* ë°˜ì‘í˜• ì¡°ì • */
        @media (max-width: 768px) {
            body {
                overflow: auto;
            }
            
            .mobile-tabs {
                display: block !important;
            }
            
            .container {
                flex-direction: column;
                height: auto;
                min-height: 100vh;
            }
            
            .preview-panel {
                width: 100%;
                border-right: none;
                padding: 15px;
                display: none !important;
            }
            
            .preview-panel.show {
                display: block !important;
            }
            
            .editor-panel {
                width: 100%;
                padding: 15px;
                display: block !important;
            }
            
            .editor-panel.hide {
                display: none !important;
            }
            
            .panel-title {
                font-size: 16px;
                margin-bottom: 15px;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
            
            .form-group input,
            .form-group textarea,
            .form-group select {
                padding: 12px 14px;
                font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
            }
            
            .form-group textarea {
                min-height: 100px;
            }
            
            .preset-button {
                padding: 12px 14px;
                font-size: 13px;
                margin-bottom: 10px;
                display: inline-block;
                width: calc(50% - 4px);
            }
            
            .format-btn, .quick-btn {
                padding: 8px 12px;
                font-size: 12px;
                margin-bottom: 5px;
            }
            
            .copy-button {
                padding: 14px 20px;
                font-size: 16px;
            }
            
            .character-image-only {
                height: 70vh;
            }
            
            .character-name {
                font-size: 1.4rem;
                bottom: 50px;
            }
            
            .character-details {
                font-size: 0.8rem;
                bottom: 25px;
            }
            
            .character-namecard {
                height: 100px;
                padding: 16px 20px;
            }
        }
        
        @media (max-width: 480px) {
            .preview-panel,
            .editor-panel {
                padding: 10px;
            }
            
            .preset-button {
                width: 100%;
                margin-right: 0;
            }
            
            .profile-preview {
                max-width: none;
            }
            
            .tab-button {
                padding: 10px 16px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- ëª¨ë°”ì¼ íƒ­ ì „í™˜ ë²„íŠ¼ -->
    <div class="mobile-tabs">
        <button class="tab-button active" onclick="switchTab('editor')">âœï¸ í¸ì§‘</button>
        <button class="tab-button" onclick="switchTab('preview')">ğŸ“± ë¯¸ë¦¬ë³´ê¸°</button>
    </div>
    
    <div class="container">
        <div class="preview-panel" id="previewPanel">
            <div class="panel-title">ë¯¸ë¦¬ë³´ê¸°</div>
            
            <div id="profilePreview" class="profile-preview profile-only"></div>
            <div id="characterImagePreview" class="character-image-only prompt-only">
                <div class="no-image">ìºë¦­í„° ì´ë¯¸ì§€ë¥¼ ì…ë ¥í•˜ë©´<br>ë„¤ì„ì¹´ë“œ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
            </div>
        </div>
        
        <div class="editor-panel" id="editorPanel">
            <div class="editor-header">
                <div class="mode-toggle">
                    <label class="toggle-switch">
                        <input type="checkbox" id="modeToggle" onchange="toggleMode()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="presets profile-only">
                <div class="form-group">
                    <label>í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°</label>
                    <div>
                        <button class="preset-button" onclick="loadPreset('yongsu')">ì„œìš©ìˆ˜ ì˜ˆì‹œ</button>
                        <button class="preset-button add-preset" onclick="saveCurrentPreset()" title="í˜„ì¬ ì„¤ì •ì„ í”„ë¦¬ì…‹ìœ¼ë¡œ ì €ì¥">+ ì €ì¥</button>
                        <button class="preset-button" onclick="clearProfile()">ì†Œê°œë€ ì´ˆê¸°í™”</button>
                    </div>
                    <div id="customPresets" style="margin-top: 10px;"></div>
                </div>
            </div>

            <div class="presets prompt-only">
                <div class="form-group">
                    <label>í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°</label>
                    <div>
                        <button class="preset-button" onclick="loadPreset('yongsu')">ì„œìš©ìˆ˜ ì˜ˆì‹œ</button>
                        <button class="preset-button" onclick="loadPreset('blank')">ë¹ˆ í…œí”Œë¦¿</button>
                        <button class="preset-button add-preset" onclick="saveCurrentPreset()" title="í˜„ì¬ ì„¤ì •ì„ í”„ë¦¬ì…‹ìœ¼ë¡œ ì €ì¥">+ ì €ì¥</button>
                        <button class="preset-button" onclick="clearPrompt()">í”„ë¡¬í”„íŠ¸ ì´ˆê¸°í™”</button>
                    </div>
                    <div id="customPresetsPrompt" style="margin-top: 10px;"></div>
                </div>
            </div>
            
            <div class="section-divider"></div>

            <div class="form-group">
                <label>ìºë¦­í„° ì´ë¦„</label>
                <input type="text" id="characterName" oninput="updatePreview(); updatePromptPreview()">
            </div>

            <div class="profile-only">
                <div class="form-group">
                    <label>ë°°ê²½ ì´ë¯¸ì§€ URL</label>
                    <input type="text" id="bgImage" oninput="updatePreview()">
                </div>
                
                <div class="form-group">
                    <label>íƒœê·¸ ìƒ‰ìƒ</label>
                    <div class="color-input">
                        <input type="color" id="tagColor" value="#993322" oninput="updatePreview()">
                        <input type="text" id="tagColorText" value="#932" oninput="updatePreview()">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ê²½ê³  íƒœê·¸ë“¤</label>
                    <div class="tags-input" id="tagsContainer">
                        <input type="text" class="add-tag-input" placeholder="íƒœê·¸ ì¶”ê°€ í›„ Enter" onkeypress="addTag(event)">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ìºë¦­í„° ì„¤ëª…</label>
                    
                    <div class="quick-insert">
                        <button class="quick-btn" onclick="insertText('{{char}}')">{{char}}</button>
                        <button class="quick-btn" onclick="insertText('{{user}}')">{{user}}</button>
                    </div>
                    
                    <div class="format-buttons">
                        <button class="format-btn" onclick="wrapSelected('-', '-')" title="ë¸”ëŸ¬">-ë¸”ëŸ¬-</button>
                        <button class="format-btn" onclick="wrapSelected('**', '**')" title="êµµê²Œ">**êµµê²Œ**</button>
                        <button class="format-btn" onclick="wrapSelected('~~', '~~')" title="ì·¨ì†Œì„ ">~~ì·¨ì†Œì„ ~~</button>
                        <button class="format-btn" onclick="wrapSelected('__', '__')" title="ë°‘ì¤„">__ë°‘ì¤„__</button>
                        <button class="format-btn" onclick="wrapSelected('^^', '^^')" title="í˜•ê´‘íœ">^^í˜•ê´‘íœ^^</button>
                        <button class="format-btn" onclick="wrapSelected('##', '##')" title="ê·¸ë¦¼ì">##ê·¸ë¦¼ì##</button>
                        <button class="format-btn" onclick="wrapSelected('%%', '%%')" title="í¬ê²Œ">%%í¬ê²Œ%%</button>
                        <button class="format-btn" onclick="wrapSelected('@@', '@@')" title="ì‘ê²Œ">@@ì‘ê²Œ@@</button>
                    </div>
                    
                    <div class="format-buttons">
                        <button class="format-btn" onclick="insertImage('small')" title="ì‘ì€ ì´ë¯¸ì§€">ğŸ–¼ï¸ ì‘ê²Œ</button>
                        <button class="format-btn" onclick="insertImage('medium')" title="ë³´í†µ ì´ë¯¸ì§€">ğŸ–¼ï¸ ë³´í†µ</button>
                        <button class="format-btn" onclick="insertImage('large')" title="í° ì´ë¯¸ì§€">ğŸ–¼ï¸ í¬ê²Œ</button>
                        <button class="format-btn" onclick="insertDivider()" title="êµ¬ë¶„ì„ ">â”€â”€â”€ êµ¬ë¶„ì„ </button>
                        <button class="format-btn" onclick="insertBox()" title="ë°•ìŠ¤">ğŸ“¦ ë°•ìŠ¤</button>
                        <button class="format-btn" onclick="insertColumns()" title="2ë‹¨ ì¹¸">ğŸ“‹ 2ì¹¸</button>
                    </div>
                    
                    <textarea id="description" oninput="updatePreview(); updatePromptPreview(); updateCharCount(); updateCharacterCount(); updateWorldCount()"></textarea>
                    <div class="char-counter" id="charCounter">0 ì</div>
                </div>
                
                <div class="form-group">
                    <label>ê¸€ê¼´ í¬ê¸°</label>
                    <select id="fontSize" onchange="updatePreview()">
                        <option value="12px">ì‘ê²Œ (12px)</option>
                        <option value="13px" selected>ë³´í†µ (13px)</option>
                        <option value="14px">í¬ê²Œ (14px)</option>
                        <option value="15px">ë§¤ìš° í¬ê²Œ (15px)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ìµœì†Œ ë†’ì´</label>
                    <select id="minHeight" onchange="updatePreview()">
                        <option value="300px">ì‘ê²Œ (300px)</option>
                        <option value="380px" selected>ë³´í†µ (380px)</option>
                        <option value="450px">í¬ê²Œ (450px)</option>
                        <option value="500px">ë§¤ìš° í¬ê²Œ (500px)</option>
                    </select>
                </div>

                <button class="copy-button" onclick="copyProfileToClipboard()">ì†Œê°œë€ HTML ë³µì‚¬</button>
            </div>

            <div class="prompt-only">
                <div class="form-group">
                    <label>ìºë¦­í„° ì´ë¯¸ì§€ URL</label>
                    <input type="text" id="characterImage" oninput="updatePromptPreview()">
                </div>

                <div class="form-group">
                    <label>ê¸°ë³¸ ì •ë³´</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" id="age" placeholder="ë‚˜ì´" oninput="updatePromptPreview()">
                        <input type="text" id="job" placeholder="ì§ì—…" oninput="updatePromptPreview()">
                    </div>
                </div>

                <div class="form-group">
                    <label>í•µì‹¬ íŠ¹ì„±</label>
                    <input type="text" id="coreTraits" oninput="updatePromptPreview()">
                </div>

                <div class="form-group">
                    <label>í•„ìˆ˜ ì¶œë ¥ í˜•ì‹</label>
                    <input type="text" id="outputFormat" oninput="updatePromptPreview()">
                </div>

                <div class="form-group">
                    <label>ìºë¦­í„° ìƒì„¸ ì„¤ì •</label>
                    
                    <div class="quick-insert">
                        <button class="quick-btn" onclick="insertPromptText('{{char}}')">{{char}}</button>
                        <button class="quick-btn" onclick="insertPromptText('{{user}}')">{{user}}</button>
                        <button class="quick-btn" onclick="wrapPromptSelected('**', '**')">êµµê²Œ</button>
                    </div>
                    
                    <textarea id="characterDetails" class="large" oninput="updatePromptPreview(); updateCharacterCount()"></textarea>
                    <div class="char-counter" id="characterCounter">0 ì</div>
                </div>

                <div class="form-group">
                    <label>ì„¸ê³„ê´€ ì„¤ì •</label>
                    
                    <div class="quick-insert">
                        <button class="quick-btn" onclick="insertWorldText('{{char}}')">{{char}}</button>
                        <button class="quick-btn" onclick="insertWorldText('{{user}}')">{{user}}</button>
                        <button class="quick-btn" onclick="wrapWorldSelected('**', '**')">êµµê²Œ</button>
                    </div>
                    
                    <textarea id="worldSettings" class="large" oninput="updatePromptPreview(); updateWorldCount()"></textarea>
                    <div class="char-counter" id="worldCounter">0 ì</div>
                </div>

                <button class="copy-button prompt" onclick="copyPromptToClipboard()">í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
            </div>
        </div>
    </div>

    <script>
        let tags = [];
        let isPromptMode = false;
        let customPresets = {}; // localStorage ëŒ€ì‹  ë©”ëª¨ë¦¬ ì €ì¥
        
        function toggleMode() {
            const modeToggle = document.getElementById('modeToggle');
            isPromptMode = modeToggle.checked;
            
            if (isPromptMode) {
                document.body.classList.add('prompt-mode');
                updatePromptPreview();
            } else {
                document.body.classList.remove('prompt-mode');
                updatePreview();
            }
        }

        function processText(text) {
            if (!text) return '';
            
            return text
                .replace(/{{char}}/g, '<b>{{char}}</b>')
                .replace(/{{user}}/g, '<b>{{user}}</b>')
                .replace(/\*\*([^*]+)\*\*/g, '<b>$1</b>')
                .replace(/-([^-]+)-/g, '<span style="filter:blur(2px)">$1</span>')
                .replace(/~~([^~]+)~~/g, '<s>$1</s>')
                .replace(/__([^_]+)__/g, '<u>$1</u>')
                .replace(/\^\^([^^]+)\^\^/g, '<span style="background:#ffeb3b;color:#000;padding:2px">$1</span>')
                .replace(/##([^#]+)##/g, '<span style="text-shadow:2px 2px 4px #000">$1</span>')
                .replace(/%%([^%]+)%%/g, '<span style="font-size:1.2em;font-weight:bold">$1</span>')
                .replace(/@@([^@]+)@@/g, '<span style="font-size:0.8em">$1</span>')
                .replace(/\n/g, '<br>');
        }
        
        function addTag(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target;
                const tagText = input.value.trim();
                if (tagText && !tags.includes(tagText)) {
                    tags.push(tagText);
                    input.value = '';
                    renderTags();
                    updatePreview();
                    updateCharCount();
                }
            }
        }
        
        function removeTag(tagText) {
            tags = tags.filter(tag => tag !== tagText);
            renderTags();
            updatePreview();
            updateCharCount();
        }
        
        function renderTags() {
            const container = document.getElementById('tagsContainer');
            if (!container) return;
            
            const input = container.querySelector('.add-tag-input');
            
            container.innerHTML = '';
            
            tags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `<span>âš ï¸${tag}</span><span class="tag-remove" onclick="removeTag('${tag}')">Ã—</span>`;
                container.appendChild(tagElement);
            });
            
            if (input) {
                container.appendChild(input);
            } else {
                const newInput = document.createElement('input');
                newInput.type = 'text';
                newInput.className = 'add-tag-input';
                newInput.placeholder = 'íƒœê·¸ ì¶”ê°€ í›„ Enter';
                newInput.addEventListener('keypress', addTag);
                container.appendChild(newInput);
            }
        }
        
        function updatePreview() {
            if (isPromptMode) return;
            
            const bgImage = document.getElementById('bgImage').value || 'https://i.imgur.com/oFaEgi7.png';
            const tagColor = document.getElementById('tagColorText').value || '#932';
            const description = document.getElementById('description').value;
            const fontSize = document.getElementById('fontSize').value;
            const minHeight = document.getElementById('minHeight').value;
            
            // ì„¤ëª…ë„ íƒœê·¸ë„ ì—†ìœ¼ë©´ ì•ˆë‚´ë©”ì‹œì§€
            if (!description && tags.length === 0) {
                document.getElementById('profilePreview').innerHTML = '<div style="text-align:center;color:#888;padding:50px;">ìºë¦­í„° ì„¤ëª…ì„ ì…ë ¥í•˜ê±°ë‚˜ íƒœê·¸ë¥¼ ì¶”ê°€í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>';
                return;
            }
            
            const tagsHtml = tags.length > 0 ? 'âš ï¸' + tags.join(' Â· ') : 'âš ï¸íƒœê·¸ì—†ìŒ';
            const processedDesc = description ? processText(description) : '';
            
            const html = `
                <div style="width:100%;max-width:480px;margin:0 auto;background:url('${bgImage}')center/cover;color:#fff;padding:25px;box-sizing:border-box;position:relative;min-height:${minHeight}">
                    <div style="text-align:center;margin-bottom:25px">
                        <span style="background:${tagColor};padding:6px 6px;border-radius:9px;font-weight:500;color:#fff">${tagsHtml}</span>
                        <div style="width:80px;height:1px;background:${tagColor};margin:12px auto"></div>
                    </div>
                    ${processedDesc ? `<div style="font-size:${fontSize};line-height:1.55;text-shadow:1px 1px 3px #000d">${processedDesc}</div>` : ''}
                </div>
            `;
            
            document.getElementById('profilePreview').innerHTML = html;
        }

        function updatePromptPreview() {
            if (!isPromptMode) return;
            
            const characterImage = document.getElementById('characterImage').value;
            const characterName = document.getElementById('characterName').value;
            const age = document.getElementById('age').value;
            const job = document.getElementById('job').value;
            const previewDiv = document.getElementById('characterImagePreview');
            
            const details = [];
            if (age) details.push(age);
            if (job) details.push(job);
            const detailsText = details.join(' Â· ') || '';
            
            // ì´ë¦„ì´ë‚˜ ì„¸ë¶€ì •ë³´ ë‘˜ ë‹¤ ì—†ìœ¼ë©´ ë„¤ì„ì¹´ë“œ ìì²´ë¥¼ ì•ˆ ë³´ì—¬ì¤Œ
            if (!characterName && !detailsText) {
                if (characterImage) {
                    previewDiv.style.backgroundImage = `url('${characterImage}')`;
                    previewDiv.innerHTML = '';
                } else {
                    previewDiv.style.backgroundImage = '';
                    previewDiv.style.backgroundColor = '#2a2a2a';
                    previewDiv.innerHTML = '';
                }
                return;
            }
            
            if (characterImage) {
                previewDiv.style.backgroundImage = `url('${characterImage}')`;
                previewDiv.innerHTML = `
                    <div class="character-namecard">
                        ${characterName ? `<div class="character-name">${characterName}</div>` : ''}
                        ${detailsText ? `<div class="character-details">${detailsText}</div>` : ''}
                    </div>
                `;
            } else {
                previewDiv.style.backgroundImage = '';
                previewDiv.style.backgroundColor = '#2a2a2a';
                previewDiv.innerHTML = `
                    <div class="character-namecard">
                        ${characterName ? `<div class="character-name">${characterName}</div>` : ''}
                        ${detailsText ? `<div class="character-details">${detailsText}</div>` : ''}
                    </div>
                `;
            }
        }
        
        function updateCharCount() {
            const bgImage = document.getElementById('bgImage').value || 'https://i.imgur.com/oFaEgi7.png';
            const tagColor = document.getElementById('tagColorText').value || '#932';
            const description = document.getElementById('description').value || '';
            const fontSize = document.getElementById('fontSize').value;
            const minHeight = document.getElementById('minHeight').value;
            
            const tagsHtml = tags.length > 0 ? 'âš ï¸' + tags.join(' Â· ') : 'âš ï¸íƒœê·¸ì—†ìŒ';
            const processedDesc = processText(description);
            
            const fullHtml = `<div style="width:100%;max-width:480px;margin:0 auto;background:url('${bgImage}')center/cover;color:#fff;padding:25px;box-sizing:border-box;position:relative;min-height:${minHeight}"><div style="text-align:center;margin-bottom:25px"><span style="background:${tagColor};padding:6px 6px;border-radius:9px;font-weight:500;color:#fff">${tagsHtml}</span><div style="width:80px;height:1px;background:${tagColor};margin:12px auto"></div></div><div style="font-size:${fontSize};line-height:1.55;text-shadow:1px 1px 3px #000d">${processedDesc}</div></div>`;
            
            const charCount = fullHtml.length;
            const counter = document.getElementById('charCounter');
            
            counter.textContent = `${charCount} ì`;
            
            if (charCount >= 1000) {
                counter.classList.add('warning');
            } else {
                counter.classList.remove('warning');
            }
        }

        function updateCharacterCount() {
            const text = document.getElementById('characterDetails').value;
            const counter = document.getElementById('characterCounter');
            const count = text.length;
            
            counter.textContent = `${count} ì`;
            
            if (count > 4000) {
                counter.classList.add('warning');
            } else {
                counter.classList.remove('warning');
            }
        }

        function updateWorldCount() {
            const text = document.getElementById('worldSettings').value;
            const counter = document.getElementById('worldCounter');
            const count = text.length;
            
            counter.textContent = `${count} ì`;
            
            if (count > 2000) {
                counter.classList.add('warning');
            } else {
                counter.classList.remove('warning');
            }
        }

        function insertTextToTextarea(textarea, text) {
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const value = textarea.value;
            
            textarea.value = value.substring(0, start) + text + value.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start + text.length, start + text.length);
            
            updatePreview();
            updatePromptPreview();
            updateCharCount();
            updateCharacterCount();
            updateWorldCount();
        }

        function wrapSelectedInTextarea(textarea, prefix, suffix) {
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const value = textarea.value;
            const selectedText = value.substring(start, end);
            
            if (selectedText) {
                const replacement = prefix + selectedText + suffix;
                textarea.value = value.substring(0, start) + replacement + value.substring(end);
                textarea.focus();
                textarea.setSelectionRange(start + prefix.length, start + prefix.length + selectedText.length);
            } else {
                insertTextToTextarea(textarea, prefix + suffix);
                textarea.setSelectionRange(start + prefix.length, start + prefix.length);
            }
        }

        function insertText(text) {
            insertTextToTextarea(document.getElementById('description'), text);
        }

        function wrapSelected(prefix, suffix) {
            wrapSelectedInTextarea(document.getElementById('description'), prefix, suffix);
        }

        function insertPromptText(text) {
            insertTextToTextarea(document.getElementById('characterDetails'), text);
        }

        function insertWorldText(text) {
            insertTextToTextarea(document.getElementById('worldSettings'), text);
        }

        function wrapPromptSelected(prefix, suffix) {
            wrapSelectedInTextarea(document.getElementById('characterDetails'), prefix, suffix);
        }

        function wrapWorldSelected(prefix, suffix) {
            wrapSelectedInTextarea(document.getElementById('worldSettings'), prefix, suffix);
        }

        function insertImage(size) {
            const url = prompt('ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”:', 'https://i.imgur.com/example.jpg');
            if (url) {
                let imageCode;
                switch(size) {
                    case 'small': imageCode = `[IMG-SMALL:${url}]`; break;
                    case 'medium': imageCode = `[IMG-MEDIUM:${url}]`; break;
                    case 'large': imageCode = `[IMG-LARGE:${url}]`; break;
                }
                insertText(imageCode);
            }
        }
        
        function insertDivider() { insertText('[DIVIDER]'); }
        
        function insertBox() {
            const selected = getSelectedText();
            if (selected) {
                replaceSelected(`[BOX:${selected}]`);
            } else {
                const content = prompt('ë°•ìŠ¤ ì•ˆì— ë“¤ì–´ê°ˆ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:', 'ì¤‘ìš”í•œ ë‚´ìš©');
                if (content) insertText(`[BOX:${content}]`);
            }
        }
        
        function insertColumns() {
            const left = prompt('ì™¼ìª½ ì¹¸ ë‚´ìš©:', 'ì™¼ìª½ ë‚´ìš©');
            const right = prompt('ì˜¤ë¥¸ìª½ ì¹¸ ë‚´ìš©:', 'ì˜¤ë¥¸ìª½ ë‚´ìš©');
            if (left && right) insertText(`[COL2:${left}|${right}]`);
        }
        
        function getSelectedText() {
            const textarea = document.getElementById('description');
            return textarea.value.substring(textarea.selectionStart, textarea.selectionEnd);
        }
        
        function replaceSelected(replacement) {
            const textarea = document.getElementById('description');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            
            textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start + replacement.length, start + replacement.length);
            
            updatePreview();
            updateCharCount();
        }
        
        function copyProfileToClipboard() {
            const bgImage = document.getElementById('bgImage').value || 'https://i.imgur.com/oFaEgi7.png';
            const tagColor = document.getElementById('tagColorText').value || '#932';
            const description = document.getElementById('description').value || '';
            const fontSize = document.getElementById('fontSize').value;
            const minHeight = document.getElementById('minHeight').value;
            
            const tagsHtml = tags.length > 0 ? 'âš ï¸' + tags.join(' Â· ') : 'âš ï¸íƒœê·¸ì—†ìŒ';
            const processedDesc = processText(description);
            
            const html = `<div style="width:100%;max-width:480px;margin:0 auto;background:url('${bgImage}')center/cover;color:#fff;padding:25px;box-sizing:border-box;position:relative;min-height:${minHeight}"><div style="text-align:center;margin-bottom:25px"><span style="background:${tagColor};padding:6px 6px;border-radius:9px;font-weight:500;color:#fff">${tagsHtml}</span><div style="width:80px;height:1px;background:${tagColor};margin:12px auto"></div></div><div style="font-size:${fontSize};line-height:1.55;text-shadow:1px 1px 3px #000d">${processedDesc}</div></div>`;
            
            navigator.clipboard.writeText(html).then(() => {
                alert('ì†Œê°œë€ HTML ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        function copyPromptToClipboard() {
            const characterName = document.getElementById('characterName').value || 'ìºë¦­í„°ëª…';
            const age = document.getElementById('age').value;
            const job = document.getElementById('job').value;
            const coreTraits = document.getElementById('coreTraits').value;
            const outputFormat = document.getElementById('outputFormat').value;
            const characterDetails = document.getElementById('characterDetails').value;
            const worldSettings = document.getElementById('worldSettings').value;

            let prompt = '# í•µì‹¬ ê·œì¹™\n1. ìºë¦­í„°: ' + characterName;
            
            if (age || job) {
                prompt += ` (${age ? age : ''}${age && job ? ', ' : ''}${job ? job : ''})`;
            }
            prompt += '\n';
            
            if (coreTraits) prompt += `2. í•µì‹¬ íŠ¹ì„±: ${coreTraits}\n`;
            if (outputFormat) prompt += `3. í•„ìˆ˜ ì¶œë ¥: ${outputFormat}\n`;
            
            prompt += '\n';

            if (characterDetails) {
                prompt += '# ìºë¦­í„° ì„¤ì •\n\n' + characterDetails + '\n\n';
            }

            if (worldSettings) {
                prompt += '# ì„¸ê³„ê´€ ì„¤ì •\n\n' + worldSettings + '\n\n';
            }

            navigator.clipboard.writeText(prompt).then(() => {
                alert('í”„ë¡¬í”„íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        // ë©”ëª¨ë¦¬ í”„ë¦¬ì…‹ ê´€ë¦¬ (localStorage ëŒ€ì‹ )
        function saveCurrentPreset() {
            const characterName = document.getElementById('characterName').value.trim();
            
            if (!characterName) {
                alert('ìºë¦­í„° ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            const presetData = {
                characterName: characterName,
                bgImage: document.getElementById('bgImage').value,
                tagColor: document.getElementById('tagColorText').value,
                tags: [...tags],
                description: document.getElementById('description').value,
                characterImage: document.getElementById('characterImage').value,
                age: document.getElementById('age').value,
                job: document.getElementById('job').value,
                coreTraits: document.getElementById('coreTraits').value,
                outputFormat: document.getElementById('outputFormat').value,
                characterDetails: document.getElementById('characterDetails').value,
                worldSettings: document.getElementById('worldSettings').value,
                fontSize: document.getElementById('fontSize').value,
                minHeight: document.getElementById('minHeight').value
            };
            
            // ë©”ëª¨ë¦¬ì— ì €ì¥
            customPresets[characterName] = presetData;
            
            alert(`"${characterName}" í”„ë¦¬ì…‹ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            loadCustomPresets();
        }
        
        function loadCustomPresets() {
            const container = document.getElementById('customPresets');
            const containerPrompt = document.getElementById('customPresetsPrompt');
            
            container.innerHTML = '';
            containerPrompt.innerHTML = '';
            
            Object.keys(customPresets).forEach(presetName => {
                // ì†Œê°œë€ìš© ë²„íŠ¼
                const button = document.createElement('button');
                button.className = 'preset-button custom';
                button.onclick = () => loadCustomPreset(presetName);
                button.innerHTML = `${presetName}<span class="preset-delete" onclick="event.stopPropagation(); deletePreset('${presetName}')" title="ì‚­ì œ">Ã—</span>`;
                container.appendChild(button);
                
                // í”„ë¡¬í”„íŠ¸ìš© ë²„íŠ¼
                const buttonPrompt = document.createElement('button');
                buttonPrompt.className = 'preset-button custom';
                buttonPrompt.onclick = () => loadCustomPreset(presetName);
                buttonPrompt.innerHTML = `${presetName}<span class="preset-delete" onclick="event.stopPropagation(); deletePreset('${presetName}')" title="ì‚­ì œ">Ã—</span>`;
                containerPrompt.appendChild(buttonPrompt);
            });
        }
        
        function loadCustomPreset(presetName) {
            const presetData = customPresets[presetName];
            
            if (!presetData) {
                alert('í”„ë¦¬ì…‹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ëª¨ë“  ê°’ ì„¤ì •
            document.getElementById('characterName').value = presetData.characterName || '';
            document.getElementById('bgImage').value = presetData.bgImage || '';
            document.getElementById('tagColorText').value = presetData.tagColor || '#932';
            document.getElementById('tagColor').value = presetData.tagColor || '#932';
            document.getElementById('description').value = presetData.description || '';
            document.getElementById('characterImage').value = presetData.characterImage || '';
            document.getElementById('age').value = presetData.age || '';
            document.getElementById('job').value = presetData.job || '';
            document.getElementById('coreTraits').value = presetData.coreTraits || '';
            document.getElementById('outputFormat').value = presetData.outputFormat || '';
            document.getElementById('characterDetails').value = presetData.characterDetails || '';
            document.getElementById('worldSettings').value = presetData.worldSettings || '';
            document.getElementById('fontSize').value = presetData.fontSize || '13px';
            document.getElementById('minHeight').value = presetData.minHeight || '380px';
            
            // íƒœê·¸ ì„¤ì •
            tags = presetData.tags || [];
            
            // ëª¨ë“  ì—…ë°ì´íŠ¸
            renderTags();
            updatePreview();
            updatePromptPreview();
            updateCharCount();
            updateCharacterCount();
            updateWorldCount();
        }
        
        function deletePreset(presetName) {
            if (!confirm(`"${presetName}" í”„ë¦¬ì…‹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            delete customPresets[presetName];
            loadCustomPresets();
        }
        
        function loadPreset(type) {
            if (type === 'yongsu') {
                document.getElementById('characterName').value = 'ì„œìš©ìˆ˜';
                document.getElementById('bgImage').value = 'https://i.imgur.com/example.jpg';
                document.getElementById('tagColorText').value = '#932';
                tags = ['ì¸¤ë°ë ˆ', 'ì•„ì €ì”¨', 'ë™ê±°'];
                document.getElementById('description').value = `ì„œìš©ìˆ˜(42ì„¸)ëŠ” ì¤‘ì†Œê¸°ì—… ê¸°ê³„ì„¤ë¹„ ê´€ë¦¬íŒ€ì¥ì´ë‹¤. ë™ë¬¼ì„ ì‹«ì–´í•œë‹¤ê³  í•˜ì§€ë§Œ, ì¹œêµ¬ ë¶€íƒìœ¼ë¡œ ìˆ˜ì¸ì„ ì¼ì£¼ì¼ê°„ ì„ì‹œë³´í˜¸í•˜ê²Œ ë˜ì—ˆë‹¤.

{{char}}:"ì•„ ì§„ì§œ... ì–´ì©” ìˆ˜ ì—†ì´ í•´ì£¼ëŠ” ê±°ì•¼."

ê²‰ìœ¼ë¡œëŠ” íˆ¬ëœê±°ë¦¬ì§€ë§Œ ì†ìœ¼ë¡œëŠ” ëˆ„êµ¬ë³´ë‹¤ ì„¸ì‹¬í•˜ê²Œ ì±™ê²¨ì¤€ë‹¤. ë§ê³¼ í–‰ë™ì´ ì •ë°˜ëŒ€ì¸ ì „í˜•ì ì¸ ì¸¤ë°ë ˆ ì•„ì €ì”¨. í˜¼ì ì‚¬ëŠ” ê²ƒì— ìµìˆ™í–ˆì§€ë§Œ, ì´ì œëŠ” ì¡°ìš©í•œ ì§‘ì´ ì–´ìƒ‰í•˜ê²Œ ëŠê»´ì§„ë‹¤.

ì§ì ‘ì ì¸ ì• ì •í‘œí˜„ì€ ì ˆëŒ€ í•˜ì§€ ì•Šì§€ë§Œ, ëª°ë˜ {{user}}ê°€ ì¢‹ì•„í•  ë§Œí•œ ê²ƒë“¤ì„ ì‚¬ë‹¤ ë†“ê±°ë‚˜ ë¬¸ìë¥¼ ë³´ë‚´ë©° ê±±ì •ì„ í‘œí˜„í•œë‹¤.`;

                document.getElementById('characterImage').value = 'https://i.imgur.com/example2.jpg';
                document.getElementById('age').value = '42ì„¸';
                document.getElementById('job').value = 'ê¸°ê³„ì„¤ë¹„ ê´€ë¦¬íŒ€ì¥';
                document.getElementById('coreTraits').value = 'ë§ê³¼ í–‰ë™ì´ ë‹¤ë¥¸ ì¸¤ë°ë ˆ ì•„ì €ì”¨';
                document.getElementById('outputFormat').value = '[ì¥ì†Œ|ìš”ì¼|ë‚ ì”¨|ğŸ’­ì†ë§ˆìŒ]';
                
                document.getElementById('characterDetails').value = `# ê¸°ë³¸ ì •ë³´
- **ì´ë¦„:** ì„œìš©ìˆ˜
- **ë‚˜ì´:** 42ì„¸  
- **ì§ì—…:** ì¤‘ì†Œê¸°ì—… ê¸°ê³„ì„¤ë¹„ ê´€ë¦¬íŒ€ì¥
- **ê±°ì£¼:** ì›ë£¸í˜• ì˜¤í”¼ìŠ¤í…” (í˜¼ì ì‚´ê¸° ë”± ì¢‹ì€ í¬ê¸°)

## ì„±ê²© í‚¤ì›Œë“œ
### ê²‰ëª¨ìŠµ
- ë¬´ëšëš, ê·€ì°®ì•„í•¨, í•‘ê³„ìŸì´, ê´€ì‹¬ì—†ëŠ”ì²™, íˆ¬ëœì´

### ì†ë§ˆìŒ  
- ì •ë§ìŒ, ì±…ì„ê°ê°•í•¨, ë”°ëœ»í•¨, ì™¸ë¡œì›€ë§ìŒ, í¬ê¸°ëª»í•¨

### í–‰ë™íŒ¨í„´
- ì¸¤ë°ë ˆ, ë‚¨ìì–´ë§ˆìŠ¤í„°, ì€ê·¼ìë‘ì¶©, ì™„ë²½ì¼€ì–´, êµ¬ë°•í•˜ë©°ì±™ê¹€`;

                document.getElementById('worldSettings').value = `## ì„¸ê³„ê´€
- ì¸ê°„ê³¼ ìˆ˜ì¸ì´ ê³µì¡´í•˜ëŠ” í˜„ëŒ€ ì‚¬íšŒ
- ìˆ˜ì¸ í¸ì… ì•½ 20ë…„, ê¸°ì„±ì„¸ëŒ€ ì¼ë¶€ ê±°ë¶€ê° ì¡´ì¬
- 2025ë…„ í˜„ì¬ í•œêµ­

## ìš©ìˆ˜ì˜ í™˜ê²½
- ì¤‘ì†Œê¸°ì—… ê¸°ê³„ì„¤ë¹„ ê´€ë¦¬íŒ€
- ì›ë£¸í˜• ì˜¤í”¼ìŠ¤í…” ê±°ì£¼
- ìµœê·¼ ìˆ˜ì¸ ì§ì›ë“¤ ì±„ìš© ì‹œì‘`;

            } else if (type === 'blank') {
                document.getElementById('characterName').value = '';
                document.getElementById('bgImage').value = '';
                document.getElementById('tagColorText').value = '#932';
                tags = [];
                document.getElementById('description').value = '';
                document.getElementById('characterImage').value = '';
                document.getElementById('age').value = '';
                document.getElementById('job').value = '';
                document.getElementById('coreTraits').value = '';
                document.getElementById('outputFormat').value = '[ì¥ì†Œ | ë‚ ì§œ | ë‚ ì”¨ì´ëª¨ì§€]';
                
                document.getElementById('characterDetails').value = `# ê¸°ë³¸ ì •ë³´
- **ì´ë¦„:** 
- **ë‚˜ì´:** 
- **ì§ì—…:** 
- **ê±°ì£¼:** 
- **ì™¸ê´€:**

## ì„±ê²© í‚¤ì›Œë“œ
### ê²‰ëª¨ìŠµ
- 

### ì†ë§ˆìŒ
- 

### í–‰ë™íŒ¨í„´
- 

## ë§íˆ¬ì™€ ë¬¸ì²´
- 

## í•µì‹¬ í–‰ë™ íŒ¨í„´
- 

## ìƒí˜¸ì‘ìš© ê°€ì´ë“œë¼ì¸
### ëŒ€í™” ìŠ¤íƒ€ì¼
- 

### ë°˜ì‘ íŒ¨í„´
- 

## ì„±ì  ë¬˜ì‚¬ ì§€ì¹¨
### í˜í‹°ì‰¬
- 

### í”Œë ˆì´ ê·œì¹™
- 

## ê¸ˆì§€ í–‰ë™
- `;

                document.getElementById('worldSettings').value = `## ì„¸ê³„ê´€ ì„¤ì •
### ì‹œëŒ€ ë°°ê²½
- 

### ì‚¬íšŒ êµ¬ì¡°
- 

### ì£¼ìš” ì„¤ì •
- 

## ìºë¦­í„° í™˜ê²½
### ê±°ì£¼ì§€
- 

### ì§ì¥/í•™êµ
- 

### ì£¼ë³€ ì¸ë¬¼
- 

## ìŠ¤í† ë¦¬ ë°°ê²½
- `;
            }
            
            renderTags();
            updatePreview();
            updatePromptPreview();
            updateCharCount();
            updateCharacterCount();
            updateWorldCount();
        }
        
        function clearProfile() {
            document.getElementById('characterName').value = '';
            document.getElementById('bgImage').value = '';
            document.getElementById('tagColorText').value = '#932';
            document.getElementById('tagColor').value = '#932';
            document.getElementById('description').value = '';
            document.getElementById('fontSize').value = '13px';
            document.getElementById('minHeight').value = '380px';
            tags = [];
            renderTags();
            updatePreview();
            updateCharCount();
        }
        
        function clearPrompt() {
            document.getElementById('characterName').value = '';
            document.getElementById('characterImage').value = '';
            document.getElementById('age').value = '';
            document.getElementById('job').value = '';
            document.getElementById('coreTraits').value = '';
            document.getElementById('outputFormat').value = '';
            document.getElementById('characterDetails').value = '';
            document.getElementById('worldSettings').value = '';
            updatePromptPreview();
            updateCharacterCount();
            updateWorldCount();
        }
        
        function clearAll() {
            // ì „ì²´ ì´ˆê¸°í™” (í”„ë¦¬ì…‹ì—ì„œë§Œ ì‚¬ìš©)
            clearProfile();
            clearPrompt();
        }
        
        function switchTab(tab) {
            const previewPanel = document.getElementById('previewPanel');
            const editorPanel = document.getElementById('editorPanel');
            const buttons = document.querySelectorAll('.tab-button');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (tab === 'preview') {
                previewPanel.classList.add('show');
                editorPanel.classList.add('hide');
                buttons[1].classList.add('active');
                updatePreview();
                updatePromptPreview();
            } else {
                previewPanel.classList.remove('show');
                editorPanel.classList.remove('hide');
                buttons[0].classList.add('active');
            }
        }
        
        // ì´ˆê¸°í™”
        renderTags();
        updatePreview();
        updatePromptPreview();
        updateCharCount();
        updateCharacterCount();
        updateWorldCount();
        loadCustomPresets(); // ì €ì¥ëœ í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸° (ë©”ëª¨ë¦¬ì—ì„œ)
        
        // ê°•ì œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
        const descriptionTextarea = document.getElementById('description');
        
        descriptionTextarea.addEventListener('input', function() {
            setTimeout(() => { updatePreview(); updateCharCount(); }, 0);
        });
        
        descriptionTextarea.addEventListener('keydown', function() {
            setTimeout(() => { updatePreview(); updateCharCount(); }, 1);
        });
        
        descriptionTextarea.addEventListener('keyup', function() {
            setTimeout(() => { updatePreview(); updateCharCount(); }, 1);
        });
        
        descriptionTextarea.addEventListener('paste', function() {
            setTimeout(() => { updatePreview(); updateCharCount(); }, 10);
        });
        
        // ë§¤ 100msë§ˆë‹¤ ê°•ì œ ì—…ë°ì´íŠ¸
        setInterval(() => {
            if (document.activeElement === descriptionTextarea) {
                updatePreview();
            }
        }, 100);
        
        // ìƒ‰ìƒ ë™ê¸°í™”
        document.getElementById('tagColor').addEventListener('input', function() {
            document.getElementById('tagColorText').value = this.value;
            updatePreview();
            updateCharCount();
        });
        
        document.getElementById('tagColorText').addEventListener('input', function() {
            document.getElementById('tagColor').value = this.value;
            updatePreview();
            updateCharCount();
        });
        
        // ì°½ í¬ê¸° ë³€ê²½ì‹œ íƒ­ ë¦¬ì…‹
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('previewPanel').classList.remove('show');
                document.getElementById('editorPanel').classList.remove('hide');
            }
        });
    </script>
</body>
</html>
